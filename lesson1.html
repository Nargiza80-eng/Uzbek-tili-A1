<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>1-dars ‚Äì Salomlashuv (Kids)</title>

  <style>
    :root{
      --bg:#F7F3EE;
      --card:#FFFFFF;
      --ink:#1F2937;
      --muted:#6B7280;
      --line:#E7E0D8;
      --accent:#6FA8A1;
      --accent2:#F2C98A;
      --good:#16a34a;
      --bad:#dc2626;
      --shadow:0 10px 26px rgba(31,41,55,0.10);
      --radius:18px;

      --primary:#0984e3;
      --success:#00b894;
      --sun:#fdcb6e;
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      padding: 18px;
    }

    .app{max-width:980px;margin:0 auto;}
    .top{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      position: relative;
      overflow:hidden;
    }

    /* ---------- Header ---------- */
    .headBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .headLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:240px;
    }
    .homeBtn{
      text-decoration:none;
      font-size:22px;
      background:#fff;
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:14px;
      box-shadow: var(--shadow);
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    h1{margin:0;font-size:22px;}
    .sub{margin-top:6px;color:var(--muted);font-weight:800}

    .albumBtn{
      border:none;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      cursor:pointer;
      font-weight:1000;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    /* ---------- Progress ---------- */
    .bar{
      margin-top:12px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      box-shadow: var(--shadow);
    }
    .barRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .track{
      height:12px;
      background:#F3F4F6;
      border-radius:999px;
      overflow:hidden;
      border:1px solid #E5E7EB;
      margin-top:10px;
    }
    .fill{height:100%;width:0%;background:var(--accent);transition:width .25s ease;}

    /* ---------- Cards (5 K√§stchen) ---------- */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:12px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      text-align:center;
      position:relative;
    }
    .emoji{font-size:50px; line-height:1;}
    .uz{font-size:30px;font-weight:1000;margin-top:8px}
    .en{font-size:18px;font-weight:1000;margin-top:8px;display:none}
    .pr{color:var(--muted);font-style:italic;margin-top:6px;font-size:13px}

    .audioBtn{
      width:100%;
      margin-top:10px;
      padding:12px;
      font-size:16px;
      border:none;
      border-radius:14px;
      background:var(--accent2);
      color:#3b2a10;
      font-weight:1000;
      cursor:pointer;
    }
    .stars{
      margin-top:8px;
      font-size:18px;
      color:#F59E0B;
      font-weight:1000;
    }

    /* Gentle feedback */
    .card.correct{ box-shadow: 0 0 0 3px rgba(111,168,161,.35); }
    .card.wrong{   box-shadow: 0 0 0 3px rgba(242,201,138,.45); }

    /* ---------- Quiz Block (unter den Karten) ---------- */
    .quizBlock{
      margin-top:14px;
      background:#F9FAFB;
      border:1px dashed #E5E7EB;
      border-radius:14px;
      padding:12px;
    }
    .qTitle{
      font-weight:1000;
      margin:0 0 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .qText{margin:0 0 10px;color:var(--muted);font-weight:900}
    .opts{display:grid;gap:8px;}
    .opt{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:1000;
      cursor:pointer;
      text-align:left;
      font-size:16px;
    }
    .opt[disabled]{opacity:.65; cursor:not-allowed;}
    .result{
      margin-top:10px;
      font-weight:1000;
      display:none;
      padding:10px;
      border-radius:14px;
      border:1px solid transparent;
    }
    .result.good{display:block;color:var(--good);background:#ECFDF5;border-color:#BBF7D0;}
    .result.bad{display:block;color:var(--bad);background:#FEF2F2;border-color:#FECACA;}

    /* ---------- Memory Block ---------- */
    .memoryBlock{
      margin-top:14px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      box-shadow: var(--shadow);
    }
    .memoryGrid{
      margin-top:10px;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(105px, 1fr));
      gap:12px;
      justify-items:center;
    }
    .mCard{
      width: clamp(95px, 26vw, 120px);
      height: clamp(95px, 26vw, 120px);
      background: var(--primary);
      border-radius: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color:#fff;
      font-weight:1000;
      font-size:22px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 6px 0 #074b81;
      padding:6px;
      transition:.2s;
    }
    .mCard:active{transform:translateY(2px); box-shadow:0 3px 0 #074b81;}
    .mCard.open{background:#fff;color:#2d3436; box-shadow:0 6px 0 #ccc;}
    .mCard.matched{background:var(--success); box-shadow:0 6px 0 #09725b; cursor:default;}

    .rowBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .btn{
      flex:1; min-width:200px;
      padding:12px;
      border-radius:14px;
      border:none;
      cursor:pointer;
      font-weight:1000;
    }
    .btnPrimary{background:var(--accent);color:#fff;}
    .btnLight{background:#fff;border:1px solid var(--line);color:var(--ink);}

    /* ---------- Celebration overlay (Quiz fertig) ---------- */
    .celebrate{
      position:absolute;
      inset:0;
      background:rgba(247,243,238,0.92);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:20;
    }
    .celebrate.show{display:flex;}
    .celebrateCard{
      max-width:560px;
      width:100%;
      background:#fff;
      border:1px solid var(--line);
      border-radius:20px;
      box-shadow: var(--shadow);
      padding:18px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .big{font-size:44px; font-weight:1000; margin:6px 0;}
    .small{color:var(--muted); font-weight:900; margin:0 0 12px;}

    /* Confetti */
    .confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden;}
    .dot{
      position:absolute;
      width:10px;height:10px;border-radius:50%;
      opacity:0.9;
      animation: fall 2.2s linear forwards;
    }
    @keyframes fall{
      0%{transform:translateY(-20px) rotate(0deg);opacity:1}
      100%{transform:translateY(520px) rotate(360deg);opacity:0.9}
    }

    /* ---------- Sticker Album ---------- */
    .album-overlay {
      display:none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .album-card {
      background: white;
      width: 85%;
      max-width: 360px;
      border-radius: 24px;
      padding: 18px;
      text-align: center;
    }
    .sticker-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 16px;
      justify-items:center;
    }
    .sticker-slot {
      width: 70px;
      height: 70px;
      background: #f1f2f6;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 35px;
      filter: grayscale(1);
      opacity: 0.2;
      border: 2px dashed #ccc;
    }
    .sticker-slot.unlocked {
      filter: none;
      opacity: 1;
      border: 3px solid var(--sun);
      background: #fff9e6;
      animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

    /* ---------- Nav ---------- */
    .navRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    a.nav,a.next{
      flex:1;
      min-width:200px;
      text-align:center;
      text-decoration:none;
      padding:12px;
      border-radius:14px;
      font-weight:1000;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    a.nav{background:#fff;border:1px solid var(--line);color:var(--ink);}
    a.next{background:var(--accent);color:#fff;}

    @media (min-width: 768px){
      .uz{font-size:34px}
      .audioBtn{font-size:18px}
      .opt{font-size:18px}
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="top" id="top">

      <!-- Celebration overlay (Quiz fertig) -->
      <div class="celebrate" id="celebrate">
        <div class="celebrateCard">
          <div class="confetti" id="confetti"></div>
          <div style="font-size:54px">üéâ</div>
          <div class="big" id="celebrateTitle">Barakalla! üéâ</div>
          <p class="small" id="celebrateText">Siz testni tugatdingiz! Juda zo‚Äòr! üåü</p>
          <p class="small" id="stickerLine" style="font-weight:1000;">üè∑Ô∏è Stiker: ‚Äî</p>

          <div class="rowBtns">
            <button class="btn btnPrimary" type="button" onclick="goNext()">‚û°Ô∏è Keyingi dars</button>
            <button class="btn btnLight" type="button" onclick="closeCelebrate()">‚úÖ Davom et</button>
          </div>
        </div>
      </div>

      <!-- Header -->
      <div class="headBar">
        <div class="headLeft">
          <a class="homeBtn" href="index.html">üè†</a>
          <div>
            <h1>üëã 1-dars: Salom!</h1>
            <div class="sub">Avval eshit üéß keyin test ‚úÖ va o‚Äòyin üß†</div>
          </div>
        </div>

        <button class="albumBtn" type="button" onclick="toggleAlbum(true)">
          üìñ Stickerlar
        </button>
      </div>

      <!-- Progress (Quiz Fortschritt) -->
      <div class="bar">
        <div class="barRow">
          <div style="font-weight:1000">‚≠ê Test natija</div>
          <div style="color:var(--muted);font-weight:1000" id="progressText">0 / 5</div>
        </div>
        <div class="track"><div class="fill" id="progressFill"></div></div>
      </div>

      <!-- 5 Audio-Karten (behalten!) -->
      <div class="grid" id="grid"></div>

      <!-- Quiz (folgt nach Karten) -->
      <div class="quizBlock" id="quizBlock">
        <div class="qTitle">
          <span>üéØ Mini-test (Hammasini top!)</span>
          <span style="color:var(--muted);font-weight:1000" id="quizMiniInfo">0 / 5</span>
        </div>
        <p class="qText" id="qText">Savol yuklanmoqda‚Ä¶</p>
        <div class="opts" id="qOpts"></div>
        <div class="result" id="qRes"></div>

        <div class="rowBtns">
          <button class="btn btnPrimary" type="button" onclick="nextQuizQuestion()">‚û°Ô∏è Keyingi savol</button>
          <button class="btn btnLight" type="button" onclick="restartQuiz()">üîÅ Qaytadan</button>
        </div>
      </div>

      <!-- Memory (folgt nach Quiz) -->
      <div class="memoryBlock">
        <div class="barRow">
          <div style="font-weight:1000">üß† Memory o‚Äòyin (Emoji ‚Üî So‚Äòz)</div>
          <div style="color:var(--muted);font-weight:1000" id="memoryBest">Best: --</div>
        </div>

        <div class="rowBtns">
          <button class="btn btnPrimary" type="button" onclick="startMemory()">‚ñ∂ Boshlash</button>
          <button class="btn btnLight" type="button" onclick="startMemory()">üîÅ Qayta aralashtir</button>
        </div>

        <div class="memoryGrid" id="memoryGrid"></div>
        <div class="result" id="mRes"></div>
      </div>

      <!-- Nav -->
      <div class="navRow">
        <a class="nav" href="index.html">‚¨ÖÔ∏è Bosh sahifa</a>
        <a class="next" href="lesson2.html">Keyingi ‚û°Ô∏è</a>
      </div>

    </div>
  </div>

  <!-- Sticker Album -->
  <div id="albumOverlay" class="album-overlay" onclick="toggleAlbum(false)">
    <div class="album-card" onclick="event.stopPropagation()">
      <h3>Mening Stikerlarim üèÜ</h3>
      <div class="sticker-grid" id="stickerGrid">
        <div class="sticker-slot" id="stk_1">üëã</div>
        <div class="sticker-slot" id="stk_2">üî¢</div>
        <div class="sticker-slot" id="stk_3">ü¶Å</div>
        <div class="sticker-slot" id="stk_4">üçé</div>
        <div class="sticker-slot" id="stk_5">üé®</div>
        <div class="sticker-slot" id="stk_6">üè†</div>
      </div>
      <button class="btn btnLight" style="margin-top:14px;width:100%;" type="button" onclick="toggleAlbum(false)">Yopish</button>
    </div>
  </div>

<script>
  // =============================
  // DATA (5 W√∂rter)
  // =============================
  const items = [
    { key:"1",  emoji:"üëã", uz:"Salom",        en:"Hello",        pr:"sa-LOM" },
    { key:"6",  emoji:"üôè", uz:"Rahmat",       en:"Thank you",    pr:"rakh-MAT" },
    { key:"9",  emoji:"üå∏", uz:"Iltimos",      en:"Please",       pr:"il-ti-MOS" },
    { key:"4",  emoji:"üôÇ", uz:"Yaxshimisiz?", en:"How are you?", pr:"yakh-shi-MI-siz" },
    { key:"11", emoji:"üåô", uz:"Xayr",         en:"Bye",          pr:"khayr" },
  ];

  // =============================
  // STORAGE
  // =============================
  const STATE_KEY   = "lesson1_combo_state_v1";
  const STICKER_KEY = "stickers";           // wie dein Album-Code
  const BEST_KEY    = "best1_memory_moves"; // Memory best

  function defaultState(){
    return {
      stars: {},      // {key:0..3}
      quizDone: {},   // {key:true}
      quizIndex: 0,   // which question now
      celebrated: false
    };
  }
  function loadState(){
    try { return JSON.parse(localStorage.getItem(STATE_KEY) || ""); }
    catch { return null; }
  }
  function saveState(s){ localStorage.setItem(STATE_KEY, JSON.stringify(s)); }
  function getState(){
    const s = loadState();
    if(!s){ const d = defaultState(); saveState(d); return d; }
    return {
      stars: s.stars || {},
      quizDone: s.quizDone || {},
      quizIndex: Number.isFinite(s.quizIndex) ? s.quizIndex : 0,
      celebrated: !!s.celebrated
    };
  }

  // =============================
  // STICKERS
  // =============================
  function getStickers(){
    try { return JSON.parse(localStorage.getItem(STICKER_KEY) || "[]"); }
    catch { return []; }
  }
  function unlockSticker(id){
    const list = getStickers();
    if(!list.includes(id)){
      list.push(id);
      localStorage.setItem(STICKER_KEY, JSON.stringify(list));
    }
  }
  function toggleAlbum(forceOpen){
    const album = document.getElementById("albumOverlay");
    const open = forceOpen ? true : (album.style.display !== "flex");
    album.style.display = open ? "flex" : "none";
    if(open){
      const earned = getStickers();
      earned.forEach(id => {
        const el = document.getElementById("stk_" + id);
        if(el) el.classList.add("unlocked");
      });
    }
  }

  // =============================
  // RENDER 5 AUDIO CARDS
  // =============================
  function starText(n){
    n = Math.max(0, Math.min(3, n));
    return "‚òÖ".repeat(n) + "‚òÜ".repeat(3-n);
  }

  function renderCards(){
    const state = getState();
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    items.forEach(it=>{
      const stars = state.stars[it.key] || 0;

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="emoji">${it.emoji}</div>
        <div class="uz">${it.uz}</div>
        <div class="pr">${it.pr}</div>

        <button class="audioBtn" data-key="${it.key}">‚ñ∂ Tinglash</button>
        <div class="stars" id="star-${it.key}">${starText(stars)}</div>

        <audio id="uz_${it.key}" src="a/${it.key}.mp3" preload="none" playsinline></audio>
      `;
      grid.appendChild(card);
    });

    grid.querySelectorAll(".audioBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const key = btn.getAttribute("data-key");
        playWordAudio(key);
      });
    });
  }

  function playWordAudio(key){
    const a = document.getElementById("uz_" + key);
    if(!a) return;
    a.currentTime = 0;
    a.play().catch(()=>{});

    const state = getState();
    state.stars[key] = Math.min(3, (state.stars[key] || 0) + 1);
    saveState(state);

    const starEl = document.getElementById("star-" + key);
    if(starEl) starEl.innerText = starText(state.stars[key]);
  }

  // =============================
  // QUIZ (nach Karten)
  // =============================
  function shuffle(arr){
    const a = [...arr];
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  // feste Reihenfolge = items
  function quizDoneCount(state){
    return Object.values(state.quizDone).filter(Boolean).length;
  }

  function updateProgressUI(){
    const state = getState();
    const done = quizDoneCount(state);
    document.getElementById("progressText").innerText = `${done} / ${items.length}`;
    document.getElementById("quizMiniInfo").innerText = `${done} / ${items.length}`;

    const pct = Math.round((done / items.length) * 100);
    document.getElementById("progressFill").style.width = pct + "%";
  }

  function renderQuizQuestion(){
    const state = getState();
    updateProgressUI();

    // finde n√§chste offene Frage
    let idx = state.quizIndex || 0;
    let safety = 0;
    while(state.quizDone[items[idx]?.key] && safety < 20){
      idx = (idx + 1) % items.length;
      safety++;
    }
    state.quizIndex = idx;
    saveState(state);

    const item = items[idx];
    const qText = document.getElementById("qText");
    const qOpts = document.getElementById("qOpts");
    const qRes  = document.getElementById("qRes");

    qRes.className = "result";
    qRes.innerText = "";

    if(quizDoneCount(state) === items.length){
      qText.innerText = "‚úÖ Hammasi bajarildi! Endi Memory o‚Äòyin o‚Äòyna üß†";
      qOpts.innerHTML = "";
      return;
    }

    qText.innerText = `‚Äú${item.uz}‚Äù nimani anglatadi?`;
    const wrong = shuffle(items.filter(x=>x.key!==item.key).map(x=>x.en)).slice(0,2);
    const options = shuffle([item.en, ...wrong]);

    qOpts.innerHTML = "";
    options.forEach(opt=>{
      const b = document.createElement("button");
      b.className = "opt";
      b.innerText = opt;
      b.disabled = !!state.quizDone[item.key];
      b.onclick = ()=> checkQuizAnswer(item.key, opt);
      qOpts.appendChild(b);
    });
  }

  function checkQuizAnswer(key, chosen){
    const state = getState();
    if(state.quizDone[key]) return;

    const item = items.find(x=>x.key===key);
    const res  = document.getElementById("qRes");

    const correct = (chosen === item.en);

    if(correct){
      res.className = "result good";
      res.innerText = "‚úÖ To‚Äòg‚Äòri! Barakalla!";
      state.quizDone[key] = true;
      state.stars[key] = 3; // belohne: 3 Sterne
      saveState(state);

      updateProgressUI();
      renderCards();

      if(quizDoneCount(state) === items.length && !state.celebrated){
        state.celebrated = true;
        saveState(state);
        // Sticker #1 f√ºr Quiz Sieg
        unlockSticker(1);
        showCelebrate("Barakalla! üéâ", "Siz testni tugatdingiz! Juda zo‚Äòr! üåü", "üëã");
        confetti();
      } else {
        // weiter zur n√§chsten Frage
        state.quizIndex = (state.quizIndex + 1) % items.length;
        saveState(state);
        setTimeout(renderQuizQuestion, 450);
      }
    } else {
      res.className = "result bad";
      res.innerText = "‚ùå Xato. Yana urinib ko‚Äòr!";
    }
  }

  function nextQuizQuestion(){
    const state = getState();
    state.quizIndex = (state.quizIndex + 1) % items.length;
    saveState(state);
    renderQuizQuestion();
  }

  function restartQuiz(){
    const s = getState();
    s.quizDone = {};
    s.quizIndex = 0;
    s.celebrated = false;
    saveState(s);
    renderCards();
    renderQuizQuestion();
    updateProgressUI();
  }

  // =============================
  // CELEBRATE Overlay
  // =============================
  function showCelebrate(title, text, stickerEmoji){
    document.getElementById("celebrateTitle").innerText = title;
    document.getElementById("celebrateText").innerText  = text;
    document.getElementById("stickerLine").innerText    = "üè∑Ô∏è Stiker: " + stickerEmoji;
    document.getElementById("celebrate").classList.add("show");
  }
  function closeCelebrate(){
    document.getElementById("celebrate").classList.remove("show");
  }
  function goNext(){
    window.location.href = "lesson2.html";
  }

  // confetti (im overlay)
  function confetti(){
    const conf = document.getElementById("confetti");
    if(!conf) return;
    conf.innerHTML = "";
    const colors = ["#F59E0B","#EF4444","#10B981","#3B82F6","#A855F7","#F97316"];
    for(let i=0;i<60;i++){
      const d = document.createElement("div");
      d.className = "dot";
      d.style.left = Math.random()*100 + "%";
      d.style.top  = (-20 - Math.random()*200) + "px";
      d.style.background = colors[Math.floor(Math.random()*colors.length)];
      d.style.animationDelay = (Math.random()*0.25) + "s";
      d.style.animationDuration = (1.6 + Math.random()*1.0) + "s";
      conf.appendChild(d);
    }
  }

  // =============================
  // MEMORY (nach Quiz)
  // =============================
  let mOpen = [];
  let mLock = false;
  let mMoves = 0;
  let mFound = 0;

  function updateMemoryBest(){
    const best = localStorage.getItem(BEST_KEY) || "--";
    document.getElementById("memoryBest").innerText = "Best: " + best;
  }

  function startMemory(){
    const grid = document.getElementById("memoryGrid");
    const res  = document.getElementById("mRes");
    res.className = "result";
    res.innerText = "";

    mOpen = [];
    mLock = false;
    mMoves = 0;
    mFound = 0;

    // cards: emoji + uz as pair
    let cards = [];
    items.forEach(it=>{
      cards.push({ id: it.key, text: it.emoji });
      cards.push({ id: it.key, text: it.uz });
    });
    cards = shuffle(cards);

    grid.innerHTML = "";
    cards.forEach(c=>{
      const div = document.createElement("div");
      div.className = "mCard";
      div.innerText = "‚ùì";
      div.dataset.id = c.id;
      div.dataset.text = c.text;
      div.dataset.open = "0";
      div.dataset.matched = "0";
      div.onclick = ()=> onMemoryClick(div);
      grid.appendChild(div);
    });

    updateMemoryBest();
  }

  function onMemoryClick(div){
    if(mLock) return;
    if(div.dataset.matched === "1") return;
    if(div.dataset.open === "1") return;
    if(mOpen.length >= 2) return;

    div.classList.add("open");
    div.innerText = div.dataset.text;
    div.dataset.open = "1";
    mOpen.push(div);

    if(mOpen.length === 2){
      mLock = true;
      mMoves++;
      setTimeout(checkMemoryMatch, 650);
    }
  }

  function checkMemoryMatch(){
    const res  = document.getElementById("mRes");
    const [a,b] = mOpen;
    if(!a || !b){ mOpen=[]; mLock=false; return; }

    if(a.dataset.id === b.dataset.id){
      a.classList.remove("open"); b.classList.remove("open");
      a.classList.add("matched"); b.classList.add("matched");
      a.dataset.matched = "1"; b.dataset.matched = "1";
      mFound++;

      if(mFound === items.length){
        // WIN: best speichern
        const best = parseInt(localStorage.getItem(BEST_KEY) || "999", 10);
        if(mMoves < best) localStorage.setItem(BEST_KEY, String(mMoves));
        updateMemoryBest();

        // Sticker #6 f√ºr Memory Sieg
        unlockSticker(6);

        res.className = "result good";
        res.innerText = `üéâ Zo‚Äòr! ${mMoves} urinishda tugatdingiz! Stiker olding! üè∑Ô∏è`;
        confetti();
        // optional: Album direkt √∂ffnen
        // toggleAlbum(true);
      } else {
        res.className = "result good";
        res.innerText = "‚úÖ Topdingiz!";
      }
    } else {
      res.className = "result bad";
      res.innerText = "‚ùå Mos emas. Yana!";
      a.classList.remove("open"); b.classList.remove("open");
      a.innerText = "‚ùì"; b.innerText = "‚ùì";
      a.dataset.open = "0"; b.dataset.open = "0";
    }

    mOpen = [];
    mLock = false;
  }

  // =============================
  // INIT
  // =============================
  function init(){
    renderCards();
    renderQuizQuestion();
    updateProgressUI();
    updateMemoryBest();
    startMemory(); // direkt sichtbar (kannst du auch entfernen, wenn erst per Klick)
  }

  init();
</script>
</body>
</html>
