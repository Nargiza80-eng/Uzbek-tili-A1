<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Dono Bola - 1. Dars</title>
  <style>
    :root {
      --bg: #f0f9ff;
      --primary: #0984e3;
      --success: #00b894;
      --error: #d63031;
      --sun: #fdcb6e;
      --card-bg: #ffffff;
      --radius: 25px;
    }

    body {
      margin: 0;
      font-family: 'Comic Sans MS', cursive;
      background: var(--bg);
      color: #2d3436;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      min-height: 100vh;
    }

    /* --- HEADER & PROGRESS --- */
    .header-box {
      background: white;
      width: 100%;
      max-width: 500px;
      border-radius: var(--radius);
      padding: 15px;
      text-align: center;
      box-shadow: 0 8px 0 rgba(0,0,0,0.05);
      margin-bottom: 20px;
      border: 4px solid white;
    }

    .progress-container {
      background: #dfe6e9;
      height: 20px;
      border-radius: 10px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-fill {
      background: var(--success);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
    }

    /* --- NAVIGATION & MODES --- */
    .mode-switch {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .mode-btn {
      padding: 12px 20px;
      border-radius: 15px;
      border: none;
      background: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 0 #ccc;
    }

    .mode-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 0 #074b81;
    }

    /* --- QUIZ SECTION --- */
    .quiz-card {
      background: white;
      border-radius: 30px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 10px 0 #dfe6e9;
      border: 4px solid white;
      width: 100%;
      max-width: 400px;
    }

    .emoji-big { font-size: 80px; margin: 10px 0; animation: bounce 2s infinite; }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .option-btn {
      width: 100%;
      padding: 15px;
      margin: 8px 0;
      border-radius: 20px;
      border: 3px solid #f1f2f6;
      background: white;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 4px 0 #f1f2f6;
    }

    .option-btn:active { transform: translateY(2px); box-shadow: none; }

    /* --- MEMORY SECTION --- */
    /* iPad + Handy: automatisch passende Spalten */
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(105px, 1fr));
      gap: 12px;
      width: 100%;
      max-width: 420px;
      justify-items: center;
    }

    .memory-card {
      width: clamp(95px, 26vw, 120px);
      height: clamp(95px, 26vw, 120px);
      background: var(--primary);
      border-radius: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 22px;
      color: white;
      cursor: pointer;
      box-shadow: 0 6px 0 #074b81;
      transition: 0.25s;
      text-align: center;
      padding: 6px;
      user-select: none;
    }

    .memory-card:active { transform: translateY(2px); box-shadow: 0 3px 0 #074b81; }

    .memory-card.flipped {
      background: white;
      color: #2d3436;
      box-shadow: 0 6px 0 #ccc;
    }

    .memory-card.matched {
      background: var(--success);
      box-shadow: 0 6px 0 #09725b;
      color: white;
      cursor: default;
      transform: none;
    }

    /* --- STICKER ALBUM --- */
    .album-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .album-card {
      background: white;
      width: 85%;
      max-width: 350px;
      border-radius: 30px;
      padding: 25px;
      text-align: center;
    }

    .sticker-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
      justify-items: center;
    }

    .sticker-slot {
      width: 70px;
      height: 70px;
      background: #f1f2f6;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 35px;
      filter: grayscale(1);
      opacity: 0.2;
      border: 2px dashed #ccc;
    }

    .sticker-slot.unlocked {
      filter: none;
      opacity: 1;
      border: 3px solid var(--sun);
      background: #fff9e6;
      animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

    /* --- WIN OVERLAY (f√ºr Memory-Sieg) --- */
    .win-overlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.65);
      z-index: 2000;
      justify-content:center;
      align-items:center;
      padding: 16px;
    }
    .win-card{
      width: 92%;
      max-width: 360px;
      background: white;
      border-radius: 30px;
      padding: 22px;
      text-align: center;
      box-shadow: 0 14px 0 rgba(0,0,0,0.12);
      border: 4px solid white;
    }
    .win-title{ font-size: 26px; font-weight: bold; margin: 6px 0; }
    .win-text{ font-size: 16px; font-weight: bold; color:#2d3436; margin: 6px 0 14px; }
    .win-sticker{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 84px;
      height: 84px;
      border-radius: 50%;
      background:#fff9e6;
      border: 4px solid var(--sun);
      font-size: 44px;
      margin: 10px 0 6px;
      animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* --- FOOTER --- */
    .nav-footer {
      margin-top: auto;
      padding: 20px;
      display: flex;
      gap: 15px;
      width: 100%;
      max-width: 500px;
    }

    .nav-btn {
      flex: 1;
      padding: 15px;
      border-radius: 20px;
      text-decoration: none;
      text-align: center;
      font-weight: bold;
      background: white;
      color: var(--primary);
      box-shadow: 0 6px 0 #ccc;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="header-box">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <a href="index.html" style="text-decoration:none; font-size: 24px;">üè†</a>
        <h2 style="margin:0;">1-dars: Salom!</h2>
        <button onclick="toggleAlbum()" style="background:none; border:none; font-size: 24px;">üìñ</button>
    </div>
    <div class="progress-container">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div style="display:flex; justify-content: space-between; font-size: 14px; font-weight: bold;">
        <span id="progressText">0 / 5</span>
        <span id="memoryBest">Best: --</span>
    </div>
  </div>

  <div class="mode-switch">
    <button class="mode-btn active" id="btnQuiz" onclick="showMode('quiz')">üéØ Test</button>
    <button class="mode-btn" id="btnMemory" onclick="showMode('memory')">üß† O'yin</button>
  </div>

  <div id="quizSection">
    <div class="quiz-card">
      <div class="emoji-big" id="qEmoji">üëã</div>
      <h2 id="qWordUz" style="font-size: 32px; margin: 10px 0;">Salom</h2>
      <button class="option-btn" style="background: var(--sun); border-color: #f39c12; margin-bottom: 15px;" onclick="playAudioCurrent()">üîä Eshitish</button>
      <div id="optionsBox"></div>
    </div>
  </div>

  <div id="memorySection" class="memory-grid" style="display:none;"></div>

  <div class="nav-footer">
    <a href="index.html" class="nav-btn">Chiqish</a>
    <button class="nav-btn" style="background:var(--success); color:white; box-shadow: 0 6px 0 #09725b;" onclick="nextStep()">Keyingisi ‚û°Ô∏è</button>
  </div>

  <!-- Sticker Album -->
  <div id="albumOverlay" class="album-overlay" onclick="toggleAlbum()">
    <div class="album-card" onclick="event.stopPropagation()">
      <h3>Mening Stikerlarim üèÜ</h3>
      <div class="sticker-grid" id="stickerGrid">
        <div class="sticker-slot" id="stk_1">üëã</div>
        <div class="sticker-slot" id="stk_2">üî¢</div>
        <div class="sticker-slot" id="stk_3">ü¶Å</div>
        <div class="sticker-slot" id="stk_4">üçé</div>
        <div class="sticker-slot" id="stk_5">üé®</div>
        <div class="sticker-slot" id="stk_6">üè†</div>
      </div>
      <button class="nav-btn" style="margin-top: 20px; width: 100%;" onclick="toggleAlbum()">Yopish</button>
    </div>
  </div>

  <!-- Memory Win Overlay -->
  <div id="winOverlay" class="win-overlay" onclick="closeWinOverlay()">
    <div class="win-card" onclick="event.stopPropagation()">
      <div style="font-size:52px">üéâ</div>
      <div class="win-title">Zo‚Äòr! Barakalla!</div>
      <div class="win-text" id="winText">Siz Memory o‚Äòyinini yutdingiz!</div>
      <div class="win-sticker" aria-hidden="true">üëã</div>
      <div style="font-weight:bold; margin-top:6px;">Stiker olding! üè∑Ô∏è</div>
      <button class="nav-btn" style="margin-top: 16px; width: 100%; background: var(--primary); color:white; box-shadow: 0 6px 0 #074b81;" onclick="openAlbumFromWin()">üìñ Albumni ochish</button>
      <button class="nav-btn" style="margin-top: 12px; width: 100%;" onclick="restartMemory()">üîÅ Yana o‚Äòynash</button>
    </div>
  </div>

  <script>
    const data = [
      { key: "1",  emoji: "üëã", uz: "Salom",        en: "Hello" },
      { key: "6",  emoji: "üôè", uz: "Rahmat",       en: "Thank you" },
      { key: "9",  emoji: "üå∏", uz: "Iltimos",      en: "Please" },
      { key: "4",  emoji: "üôÇ", uz: "Yaxshimisiz?", en: "How are you?" },
      { key: "11", emoji: "üåô", uz: "Xayr",         en: "Bye" }
    ];

    let currentIdx = 0;
    let quizScore = 0;

    let memoryMoves = 0;
    let matchesFound = 0;
    let flippedCards = [];
    let lockBoard = false;

    // ========== SOUND (ohne externe URLs, zuverl√§ssig) ==========
    let audioCtx = null;
    function beep(freq=740, dur=0.14){
      const AC = window.AudioContext || window.webkitAudioContext;
      if(!AC) return;
      if(!audioCtx) audioCtx = new AC();
      if(audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "triangle";
      o.frequency.value = freq;
      g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + dur);
    }
    const sfx = {
      correct(){ beep(880, 0.16); },
      wrong(){ beep(220, 0.18); },
      win(){ beep(660, 0.12); setTimeout(()=>beep(880,0.14),140); setTimeout(()=>beep(990,0.16),290); }
    };

    // --- MODES ---
    function showMode(mode) {
      document.getElementById('btnQuiz').classList.toggle('active', mode === 'quiz');
      document.getElementById('btnMemory').classList.toggle('active', mode === 'memory');
      document.getElementById('quizSection').style.display = mode === 'quiz' ? 'block' : 'none';
      document.getElementById('memorySection').style.display = mode === 'memory' ? 'grid' : 'none';
      if(mode === 'memory') initMemory(); else loadQuiz();
    }

    // --- QUIZ ---
    function loadQuiz() {
      const item = data[currentIdx];
      document.getElementById('qEmoji').innerText = item.emoji;
      document.getElementById('qWordUz').innerText = item.uz;

      const optionsBox = document.getElementById('optionsBox');
      optionsBox.innerHTML = '';

      let choices = [item.en];
      while(choices.length < 3) {
        let r = data[Math.floor(Math.random()*data.length)].en;
        if(!choices.includes(r)) choices.push(r);
      }
      choices.sort(() => Math.random() - 0.5);

      choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.innerText = c;
        btn.onclick = () => {
          if(c === item.en) {
            btn.style.background = 'var(--success)';
            btn.style.color = 'white';
            quizScore++;
            updateProgress();
            sfx.correct();
            setTimeout(nextStep, 700);
          } else {
            btn.style.background = 'var(--error)';
            btn.style.color = 'white';
            sfx.wrong();
            setTimeout(() => { btn.style.background = 'white'; btn.style.color = '#2d3436'; }, 600);
          }
        };
        optionsBox.appendChild(btn);
      });
    }

    function playAudioCurrent() {
      new Audio(`a/${data[currentIdx].key}.mp3`).play().catch(() => alert("Audio file not found"));
    }

    function nextStep() {
      currentIdx = (currentIdx + 1) % data.length;
      if(quizScore >= data.length) {
          unlockSticker(1);   // üëã Sticker
          confetti();
          sfx.win();
          quizScore = 0;
      }
      loadQuiz();
    }

    function updateProgress() {
      const pct = (quizScore / data.length) * 100;
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('progressText').innerText = `${quizScore} / ${data.length}`;
    }

    // --- MEMORY ---
    function initMemory() {
      const grid = document.getElementById('memorySection');
      grid.innerHTML = '';
      matchesFound = 0;
      memoryMoves = 0;
      flippedCards = [];
      lockBoard = false;

      let cards = [];
      data.forEach(item => {
        // Pair: emoji + uz word (same id)
        cards.push({ id: item.key, val: item.emoji, type:"emoji" });
        cards.push({ id: item.key, val: item.uz,    type:"word"  });
      });
      cards.sort(() => Math.random() - 0.5);

      cards.forEach(c => {
        const div = document.createElement('div');
        div.className = 'memory-card';
        div.innerText = "‚ùì";
        div.dataset.id = c.id;
        div.dataset.val = c.val;
        div.dataset.open = "0";
        div.dataset.matched = "0";

        div.onclick = () => {
          if(lockBoard) return;
          if(div.dataset.matched === "1") return;
          if(div.dataset.open === "1") return;
          if(flippedCards.length >= 2) return;

          flipOpen(div);

          flippedCards.push(div);
          if(flippedCards.length === 2) {
            lockBoard = true;
            memoryMoves++;
            setTimeout(checkMatch, 650);
          }
        };
        grid.appendChild(div);
      });

      // Best anzeigen
      document.getElementById('memoryBest').innerText = "Best: " + (localStorage.getItem("best1") || "--");
    }

    function flipOpen(div){
      div.classList.add('flipped');
      div.innerText = div.dataset.val;
      div.dataset.open = "1";
      sfx.correct(); // kleines positives ‚Äúclick‚Äù
    }
    function flipClose(div){
      div.classList.remove('flipped');
      div.innerText = "‚ùì";
      div.dataset.open = "0";
    }

    function checkMatch() {
      const [a, b] = flippedCards;

      if(!a || !b){
        flippedCards = [];
        lockBoard = false;
        return;
      }

      const same = (a.dataset.id === b.dataset.id);

      if(same) {
        a.classList.add('matched'); b.classList.add('matched');
        a.dataset.matched = "1"; b.dataset.matched = "1";
        matchesFound++;

        if(matchesFound === data.length) {
          // ‚úÖ WIN: Best speichern + Sticker geben
          const best = parseInt(localStorage.getItem("best1") || "999", 10);
          if(memoryMoves < best) localStorage.setItem("best1", String(memoryMoves));

          unlockSticker(1); // üëã Sticker als Belohnung
          confetti();
          sfx.win();

          document.getElementById('memoryBest').innerText =
            "Best: " + (localStorage.getItem("best1") || "--");

          openWinOverlay();
          flippedCards = [];
          lockBoard = false;
          return;
        }
      } else {
        sfx.wrong();
        setTimeout(() => {
          flipClose(a);
          flipClose(b);
        }, 120);
      }

      flippedCards = [];
      lockBoard = false;

      document.getElementById('memoryBest').innerText =
        "Best: " + (localStorage.getItem("best1") || "--");
    }

    function restartMemory(){
      closeWinOverlay();
      initMemory();
      showMode('memory');
    }

    // --- WIN OVERLAY ---
    function openWinOverlay(){
      const text = document.getElementById("winText");
      text.innerText = `Zo‚Äòr! ${memoryMoves} urinishda tugatdingiz!`;
      document.getElementById("winOverlay").style.display = "flex";
    }
    function closeWinOverlay(){
      document.getElementById("winOverlay").style.display = "none";
    }
    function openAlbumFromWin(){
      closeWinOverlay();
      toggleAlbum(true);
    }

    // --- STICKERS & ALBUM ---
    function toggleAlbum(forceOpen=false) {
      const album = document.getElementById('albumOverlay');
      const isVisible = album.style.display === 'flex';
      album.style.display = (forceOpen || !isVisible) ? 'flex' : 'none';

      if(album.style.display === 'flex') {
        let earned = JSON.parse(localStorage.getItem("stickers") || "[]");
        earned.forEach(id => {
          const el = document.getElementById('stk_'+id);
          if(el) el.classList.add('unlocked');
        });
      }
    }

    function unlockSticker(id) {
      let earned = JSON.parse(localStorage.getItem("stickers") || "[]");
      if(!earned.includes(id)) {
        earned.push(id);
        localStorage.setItem("stickers", JSON.stringify(earned));
      }
    }

    // --- CONFETTI ---
    function confetti() {
      for(let i=0; i<30; i++) {
        const c = document.createElement('div');
        c.style.position = 'fixed';
        c.style.left = Math.random()*100+'vw';
        c.style.top = '-10px';
        c.style.width = '10px'; c.style.height = '10px';
        c.style.backgroundColor = ['#f1c40f','#e67e22','#2ecc71','#3498db'][Math.floor(Math.random()*4)];
        c.style.borderRadius = '50%';
        c.style.zIndex = 2000;
        document.body.appendChild(c);
        c.animate(
          [{ transform: 'translateY(0)' }, { transform: `translateY(100vh) translateX(${Math.random()*100-50}px)` }],
          { duration: 2000 }
        );
        setTimeout(() => c.remove(), 2000);
      }
    }

    // Start
    loadQuiz();
    document.getElementById('memoryBest').innerText = "Best: " + (localStorage.getItem("best1") || "--");
  </script>
</body>
</html>
