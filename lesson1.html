<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Dono Bola - 1. Dars</title>

  <style>
    :root{
      /* ‚úÖ kr√§ftige, kinderfreundliche Farben */
      --bg: #fff3d6;
      --primary: #0066ff;
      --primaryDark:#0047b3;
      --success: #00c853;
      --error: #ff1744;
      --sun: #ffcc00;
      --orange: #ff6d00;
      --dark: #1f2937;
      --radius: 20px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--dark);
      min-height:100vh;
      padding: 15px;
      display:flex;
      flex-direction:column;
      align-items:center;

      /* ‚úÖ sofort sichtbarer kr√§ftiger Hintergrund */
      background: radial-gradient(circle at top, #ffffff 0%, var(--bg) 55%, #ffe2a6 100%);
    }

    /* --- HEADER --- */
    .header-box{
      width:100%;
      max-width:520px;
      background:white;
      border-radius: var(--radius);
      padding: 15px;
      text-align:center;
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      margin-bottom: 15px;
      border-top: 10px solid var(--primary);
      border-left: 2px solid rgba(0,0,0,0.06);
      border-right: 2px solid rgba(0,0,0,0.06);
      border-bottom: 2px solid rgba(0,0,0,0.06);
    }
    .topRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .topIcon{
      font-size:30px;
      cursor:pointer;
      user-select:none;
    }
    .title{
      margin:0;
      color: var(--primary);
      font-weight: 1000;
      letter-spacing:.2px;
    }

    .progress-container{
      background:#e5e7eb;
      height: 16px;
      border-radius: 999px;
      margin: 12px 0 8px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .progress-fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--success), #19e68c);
      transition: width .45s ease;
    }
    #progText{ font-weight: 900; }

    /* --- NAV --- */
    .mode-nav{
      width:100%;
      max-width:520px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom: 15px;
    }
    .mode-btn{
      padding: 14px 12px;
      border-radius: 15px;
      border: none;
      background:white;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 5px 0 rgba(0,0,0,0.16);
      font-size: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
      touch-action: manipulation;
    }
    .mode-btn:active{ transform: translateY(2px); box-shadow: 0 3px 0 rgba(0,0,0,0.16); }

    .mode-btn.active{ color:#fff; }
    #btnLearn.active  { background: linear-gradient(180deg, var(--primary), var(--primaryDark)); }
    #btnQuiz.active   { background: linear-gradient(180deg, var(--orange), #ff3d00); }
    #btnMemory.active { background: linear-gradient(180deg, var(--success), #009e45); }
    #btnBubble.active { background: linear-gradient(180deg, #111827, #000000); }

    /* --- CONTENT --- */
    #learnSection, #quizSection, #memorySection, #bubbleSection{
      width:100%;
      max-width:520px;
      display:none;
    }

    .card{
      background:white;
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.08);
      margin-bottom: 10px;
      border: 1px solid rgba(0,0,0,0.06);
    }

    /* Learn list */
    .learnRow{
      display:flex;
      align-items:center;
      gap:14px;
    }
    .emojiBig{ font-size:44px; width:56px; text-align:center; }
    .wordBox{ flex:1; }
    .wordMain{ font-weight:1000; font-size:20px; }
    .wordSub{ opacity:.75; margin-top:2px; font-weight:800; }

    .btn-audio{
      background: var(--sun);
      border:none;
      width: 60px;
      height: 60px;
      border-radius: 16px;
      font-size: 28px;
      cursor:pointer;
      box-shadow: 0 5px 0 #caa000;
      user-select:none;
      touch-action: manipulation;
    }
    .btn-audio:active{ transform: translateY(2px); box-shadow: 0 3px 0 #caa000; }

    /* Quiz */
    #qEmoji{ font-size:96px; text-align:center; }
    #qWord{ margin: 6px 0 12px; text-align:center; font-size:28px; font-weight:1000; }
    .optBtn{
      width:100%;
      padding: 14px 12px;
      border-radius: 16px;
      border: 2px solid rgba(0,0,0,0.06);
      background:white;
      font-weight:1000;
      font-size:16px;
      cursor:pointer;
      box-shadow: 0 5px 0 rgba(0,0,0,0.10);
      margin-bottom:10px;
      touch-action: manipulation;
    }
    .optBtn:active{ transform: translateY(2px); box-shadow: 0 3px 0 rgba(0,0,0,0.10); }
    .optBtn.ok{ background: var(--success); color:#fff; border-color: transparent; }
    .optBtn.no{ background: var(--error); color:#fff; border-color: transparent; }

    /* Memory */
    .memory-grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .memory-card{
      height: 104px;
      background: linear-gradient(180deg, var(--primary), var(--primaryDark));
      border-radius: 14px;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size: 24px;
      color:#fff;
      cursor:pointer;
      font-weight:1000;
      transition: transform .12s ease;
      user-select:none;
      border: 2px solid rgba(255,255,255,0.25);
      touch-action: manipulation;
    }
    .memory-card:active{ transform: scale(.98); }
    .memory-card.flipped{
      background:#fff;
      color: var(--dark);
      border: 2px solid var(--primary);
    }
    .memory-card.matched{ visibility:hidden; }

    /* Bubble */
    #bubbleArea{
      background: radial-gradient(circle at top, #4da3ff 0%, var(--primary) 45%, #003c9e 100%);
      height: 420px;
      border-radius: 22px;
      position:relative;
      overflow:hidden;
      border: 6px solid #fff;
      box-shadow: 0 12px 26px rgba(0,0,0,0.14);
    }
    .bubble{
      position:absolute;
      width: 78px;
      height: 78px;
      background: rgba(255,255,255,0.55);
      border-radius: 50%;
      border: 2px solid #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 36px;
      cursor:pointer;
      user-select:none;
      animation: floatUp 4s linear forwards;
      backdrop-filter: blur(3px);
      touch-action: manipulation;
    }
    @keyframes floatUp{
      from{ bottom: -90px; transform: translateY(0); }
      to{ bottom: 460px; transform: translateY(-10px); }
    }

    /* Overlay celebration */
    .overlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.80);
      z-index: 2000;
      align-items:center;
      justify-content:center;
      padding: 16px;
    }
    .celeb-box{
      width:min(420px, 92vw);
      background:white;
      padding: 24px;
      border-radius: 26px;
      text-align:center;
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      border: 6px solid rgba(255,255,255,0.8);
    }
    .celebBtn{
      width:100%;
      padding: 14px;
      background: linear-gradient(180deg, var(--success), #009e45);
      color:white;
      border:none;
      border-radius: 14px;
      font-weight:1000;
      cursor:pointer;
      margin-top: 10px;
      font-size: 16px;
      box-shadow: 0 6px 0 #047a3b;
      touch-action: manipulation;
    }
    .celebBtn:active{ transform: translateY(2px); box-shadow: 0 4px 0 #047a3b; }
  </style>
</head>

<body>

  <div class="overlay" id="celebOverlay">
    <div class="celeb-box">
      <div id="celebEmoji" style="font-size:80px;">üèÜ</div>
      <h2 id="celebTitle" style="margin:8px 0 6px;">Barakalla!</h2>
      <p id="celebText" style="margin:0; font-weight:800; opacity:.85;">Darsni a'lo darajada tugatdingiz!</p>
      <button class="celebBtn" onclick="closeCeleb()">DAVOM ETAMIZ ‚úÖ</button>
    </div>
  </div>

  <div class="header-box">
    <div class="topRow">
      <span class="topIcon" onclick="goHome()" aria-label="Home">üè†</span>
      <h2 class="title">1-Dars</h2>
      <span class="topIcon" onclick="toggleBookHint()" aria-label="Book">üìñ</span>
    </div>

    <div class="progress-container">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div id="progText">0 / 5</div>
  </div>

  <div class="mode-nav">
    <button class="mode-btn active" id="btnLearn" onclick="changeMode('learn')">üìñ O'rganish</button>
    <button class="mode-btn" id="btnQuiz" onclick="changeMode('quiz')">üéØ Test</button>
    <button class="mode-btn" id="btnMemory" onclick="changeMode('memory')">üß† O'yin</button>
    <button class="mode-btn" id="btnBubble" onclick="changeMode('bubble')" style="grid-column: span 2;">ü´ß Pufakchalar</button>
  </div>

  <div id="learnSection"></div>

  <div id="quizSection">
    <div class="card">
      <div id="qEmoji">üëã</div>
      <div id="qWord">Salom</div>

      <button class="btn-audio" style="width:100%; height:auto; border-radius:16px; padding:14px; box-shadow:0 5px 0 #caa000; font-weight:1000;"
              onclick="playCurrentQuizAudio()">üîä Eshitish</button>

      <div style="height:12px;"></div>
      <div id="optionsBox"></div>
    </div>
  </div>

  <div id="memorySection">
    <div class="card" style="font-weight:1000; margin-bottom:10px;">
      üß† Memory: topib juftini qiling!
    </div>
    <div class="memory-grid" id="memGrid"></div>
  </div>

  <div id="bubbleSection">
    <div class="card" id="bTask" style="text-align:center; font-weight:1000; font-size:22px;"></div>
    <div id="bubbleArea"></div>
  </div>

  <script>
    // --- DATA ---
    const data = [
      { key: "1",  emoji: "üëã", uz: "Salom",        en: "Hello" },
      { key: "6",  emoji: "üôè", uz: "Rahmat",       en: "Thank you" },
      { key: "9",  emoji: "üå∏", uz: "Iltimos",      en: "Please" },
      { key: "4",  emoji: "üôÇ", uz: "Yaxshimisiz?", en: "How are you?" },
      { key: "11", emoji: "üåô", uz: "Xayr",         en: "Bye" }
    ];

    // ‚úÖ Audio folders like your old lesson:
    // Uzbek: a/<key>.mp3
    // English: en/<key>.mp3
    let currentLang = "uz";

    function audioPath(key){
      return (currentLang === "en") ? `en/${key}.mp3` : `a/${key}.mp3`;
    }

    // One global audio (no overlap)
    let currentAudio = null;
    function playAudio(key, rate=1.0){
      try{
        if(currentAudio){
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
      }catch(e){}
      const a = new Audio(audioPath(key));
      a.playbackRate = rate;
      currentAudio = a;
      a.play().catch(()=>{});
      return a;
    }

    // --- STATE ---
    let quizIdx = 0;
    let flippedCards = [];
    let matches = 0;
    let bubbleIdx = 0;
    let bubbleTimer = null;

    // --- UI HELPERS ---
    function setActiveButton(mode){
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
      const btnId = 'btn' + mode.charAt(0).toUpperCase() + mode.slice(1);
      const btn = document.getElementById(btnId);
      if(btn) btn.classList.add('active');
    }

    function showSection(mode){
      const sections = ['learnSection','quizSection','memorySection','bubbleSection'];
      sections.forEach(id => document.getElementById(id).style.display = 'none');
      document.getElementById(mode + 'Section').style.display = 'block';
    }

    function stopBubbles(){
      if(bubbleTimer){ clearInterval(bubbleTimer); bubbleTimer = null; }
    }

    function updateProg(){
      // progress based on quizIdx (like your simple version)
      const p = (quizIdx / data.length) * 100;
      document.getElementById('progressFill').style.width = p + '%';
      document.getElementById('progText').innerText = quizIdx + " / " + data.length;
    }

    // --- NAV ---
    function changeMode(m){
      stopBubbles();
      setActiveButton(m);
      showSection(m);

      if(m === 'learn') renderLearn();
      if(m === 'quiz') loadQuiz();
      if(m === 'memory') initMemory();
      if(m === 'bubble') startBubbles();
    }

    // --- LEARN ---
    function renderLearn(){
      const cont = document.getElementById('learnSection');
      cont.innerHTML = '';

      data.forEach(item => {
        const d = document.createElement('div');
        d.className = 'card';

        d.innerHTML = `
          <div class="learnRow">
            <div class="emojiBig">${item.emoji}</div>
            <div class="wordBox">
              <div class="wordMain">${item.uz}</div>
              <div class="wordSub">${item.en}</div>
            </div>
            <button class="btn-audio" aria-label="Play audio">üîä</button>
          </div>
        `;

        const btn = d.querySelector('.btn-audio');
        btn.addEventListener('click', ()=> playAudio(item.key, 1.0));

        cont.appendChild(d);
      });
    }

    // --- QUIZ ---
    function playCurrentQuizAudio(){
      const item = data[quizIdx % data.length];
      playAudio(item.key, 1.0);
    }

    function loadQuiz(){
      updateProg();

      const item = data[quizIdx % data.length];
      document.getElementById('qEmoji').innerText = item.emoji;
      document.getElementById('qWord').innerText = item.uz;

      // choices: correct + 2 random wrong from data
      const correct = item.en;
      const pool = data.map(d => d.en).filter(x => x !== correct);
      const wrong1 = pool[Math.floor(Math.random()*pool.length)];
      let wrong2 = pool[Math.floor(Math.random()*pool.length)];
      if(wrong2 === wrong1) wrong2 = pool[(pool.indexOf(wrong1)+1) % pool.length];

      let opts = [correct, wrong1, wrong2].sort(()=>Math.random()-0.5);

      const box = document.getElementById('optionsBox');
      box.innerHTML = '';

      opts.forEach(o=>{
        const b = document.createElement('button');
        b.className = 'optBtn';
        b.innerText = o;

        b.onclick = ()=>{
          // lock to prevent double click spam
          box.querySelectorAll('button').forEach(x=> x.disabled = true);

          if(o === correct){
            b.classList.add('ok');
            quizIdx++;
            setTimeout(()=>{
              if(quizIdx >= data.length){
                showCeleb("üéâ", "Barakalla!", "Test tugadi! ‚úÖ");
                quizIdx = 0;
              }
              loadQuiz();
            }, 420);
          }else{
            b.classList.add('no');
            setTimeout(()=>{
              loadQuiz(); // reset question quickly
            }, 520);
          }
        };

        box.appendChild(b);
      });
    }

    // --- MEMORY ---
    function initMemory(){
      matches = 0;
      flippedCards = [];
      const grid = document.getElementById('memGrid');
      grid.innerHTML = '';

      let cards = [];
      data.forEach(d=>{
        cards.push({k:d.key, v:d.emoji});
        cards.push({k:d.key, v:d.uz});
      });
      cards.sort(()=>Math.random()-0.5);

      cards.forEach(c=>{
        const el = document.createElement('div');
        el.className = 'memory-card';
        el.innerText = '‚ùì';

        el.onclick = ()=>{
          if(flippedCards.length >= 2) return;
          if(el.classList.contains('flipped') || el.classList.contains('matched')) return;

          el.classList.add('flipped');
          el.innerText = c.v;
          flippedCards.push({el, k:c.k});

          if(flippedCards.length === 2){
            setTimeout(()=>{
              const a = flippedCards[0];
              const b = flippedCards[1];

              if(a.k === b.k){
                a.el.classList.add('matched');
                b.el.classList.add('matched');
                matches++;

                if(matches === data.length){
                  showCeleb("üèÜ", "Zo'r!", "Memory tugadi! ‚úÖ");
                }
              }else{
                a.el.classList.remove('flipped'); a.el.innerText = '‚ùì';
                b.el.classList.remove('flipped'); b.el.innerText = '‚ùì';
              }
              flippedCards = [];
            }, 650);
          }
        };

        grid.appendChild(el);
      });
    }

    // --- BUBBLES ---
    function updateBTask(){
      document.getElementById('bTask').innerText = "Top: " + data[bubbleIdx].uz;
    }

    function startBubbles(){
      stopBubbles();
      bubbleIdx = 0;
      updateBTask();

      const area = document.getElementById('bubbleArea');
      area.innerHTML = '';

      bubbleTimer = setInterval(()=>{
        const b = document.createElement('div');
        const rand = data[Math.floor(Math.random()*data.length)];
        b.className = 'bubble';
        b.innerText = rand.emoji;
        b.style.left = (Math.random()*78 + 8) + '%';

        b.onclick = ()=>{
          if(rand.key === data[bubbleIdx].key){
            // correct
            b.style.background = "rgba(0,200,83,0.75)";
            b.innerText = "‚≠ê";
            setTimeout(()=> b.remove(), 120);

            bubbleIdx++;
            if(bubbleIdx >= data.length){
              stopBubbles();
              showCeleb("üê†", "Super!", "Pufakchalar tugadi! ‚úÖ");
              return;
            }
            updateBTask();
          }else{
            // wrong
            b.style.background = "rgba(255,23,68,0.60)";
            b.innerText = "üí®";
            setTimeout(()=> b.remove(), 120);
          }
        };

        area.appendChild(b);
        setTimeout(()=>{ try{ b.remove(); }catch(e){} }, 4000);
      }, 1200);
    }

    // --- OVERLAY ---
    function showCeleb(emoji, title, text){
      document.getElementById('celebEmoji').innerText = emoji || "üèÜ";
      document.getElementById('celebTitle').innerText = title || "Barakalla!";
      document.getElementById('celebText').innerText = text || "Zo'r!";
      document.getElementById('celebOverlay').style.display = 'flex';
    }
    function closeCeleb(){
      document.getElementById('celebOverlay').style.display = 'none';
      changeMode('learn');
    }

    // --- Header icons ---
    function goHome(){
      // if you want: location.href = "index.html";
      location.reload();
    }
    function toggleBookHint(){
      showCeleb("üìñ", "Eslatma", "Audio fayllar: a/1.mp3, en/1.mp3 (va hokazo).");
    }

    // --- INIT ---
    renderLearn();
    changeMode('learn');
    updateProg();
  </script>
</body>
</html>
