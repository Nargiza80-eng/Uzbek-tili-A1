<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sonlar 1‚Äì10 (O'quv Darsligi)</title>

  <style>
    :root {
      /* üåà fr√∂hliche Farben */
      --bg: #FFF7ED;
      --card: #FFFFFF;
      --ink: #1F2937;
      --muted: #6B7280;

      --accent: #6366F1;       /* Indigo */
      --accent-dark: #4F46E5;
      --good: #22C55E;
      --bad: #EF4444;

      --gold: #F59E0B;         /* Sterne */
      --yellow: #FACC15;       /* Speaker */

      --shadow: 0 12px 28px rgba(0,0,0,0.10);
      --radius: 26px;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      padding: 15px;
    }

    .app { max-width: 800px; margin: 0 auto; }

    /* Header & Progress */
    .top-section {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 25px;
      margin-bottom: 25px;
      text-align: center;
    }

    .langSwitch {
      display: inline-flex;
      background: #EEF2FF;
      padding: 4px;
      border-radius: 50px;
      margin-top: 15px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }

    .langBtn {
      border: none;
      padding: 8px 20px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 900;
      transition: 0.25s;
      background: transparent;
      color: var(--accent-dark);
    }

    .langBtn.active { background: var(--accent); color: white; }

    .track {
      height: 14px;
      background: #E5E7EB;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 15px;
    }

    .fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--good));
      transition: width 0.6s ease;
    }

    /* Vokabel Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      padding: 18px;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover { transform: translateY(-4px) scale(1.03); }

    .num-circle {
      width: 45px;
      height: 45px;
      background: #EEF2FF;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      font-weight: 900;
      font-size: 22px;
      color: var(--accent-dark);
    }

    .word { font-size: 20px; font-weight: 800; margin-bottom: 10px; }

    /* üîä runder Speaker */
    .btn-play {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      border: none;
      background: var(--yellow);
      font-size: 26px;
      cursor: pointer;
      box-shadow: inset 0 -6px 0 rgba(0,0,0,0.15);
      transition: transform 0.15s ease;
    }
    .btn-play:active { transform: scale(0.9); }

    .starsLine { margin-top: 8px; color: var(--gold); font-weight: 1000; letter-spacing: 2px; }

    /* Game Card */
    .game-card {
      background: white;
      border-radius: var(--radius);
      padding: 22px;
      margin-bottom: 22px;
      box-shadow: var(--shadow);
      position: relative;
    }

    .game-title {
      font-size: 22px;
      font-weight: 900;
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--accent-dark);
    }

    .status-badge {
      font-size: 14px;
      background: #EEF2FF;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--accent-dark);
    }
    .status-badge.done { background:#ECFDF5; color: var(--good); }

    .choiceRow {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 18px;
    }

    .btn-choice {
      padding: 14px 22px;
      border: 2px solid #E5E7EB;
      background: white;
      border-radius: 16px;
      cursor: pointer;
      font-weight: 900;
      font-size: 18px;
      transition: 0.18s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }
    .btn-choice:hover { border-color: var(--accent); transform: translateY(-1px); }
    .btn-choice.good { background: var(--good); color: white; border-color: var(--good); }
    .btn-choice.bad  { background: var(--bad);  color: white; border-color: var(--bad); }

    #emojiArea {
      font-size: 40px;
      letter-spacing: 8px;
      margin: 18px 0;
      text-align: center;
      min-height: 60px;
    }

    /* Matching Game */
    .matching-box { display: flex; gap: 15px; margin-top: 15px; }
    .col { flex: 1; display: flex; flex-direction: column; gap: 10px; }

    .drag-item {
      padding: 14px;
      background: #F8FAFC;
      border: 2px solid #E5E7EB;
      border-radius: 14px;
      text-align: center;
      cursor: grab;
      font-weight: 900;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }

    .drop-zone {
      padding: 14px;
      border: 2px dashed var(--accent);
      border-radius: 14px;
      text-align: center;
      min-height: 25px;
      transition: 0.25s;
      background: #fff;
      font-weight: 900;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }
    .drop-zone.over { background: #EEF2FF; }
    .drop-zone.bad  { background: #FEF2F2; border-color: #FECACA; }
    .matched { background: var(--good) !important; color: white; border-color: var(--good) !important; }

    /* Buttons inside games */
    .gameActionBtn{
      width:100%;
      margin-top:18px;
      border:none;
      border-radius:16px;
      padding:14px;
      font-weight:1000;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.08);
    }
    .gameActionBtn.primary{ background: var(--accent); color: #fff; }
    .gameActionBtn.gold{ background: var(--gold); color: #1F2937; }
  </style>
</head>

<body>
<div class="app">
  <div class="top-section">
    <h1 style="margin:0; font-size: 28px;">üî¢ 2-Dars: Sonlar</h1>
    <div id="progLabel">0 / 10 o'rganildi</div>
    <div class="track"><div class="fill" id="progFill"></div></div>

    <div class="langSwitch">
      <button id="btn-uz" class="langBtn active" onclick="setLang('uz')">O'zbekcha</button>
      <button id="btn-en" class="langBtn" onclick="setLang('en')">English</button>
    </div>
  </div>

  <div class="grid" id="vocabGrid"></div>

  <!-- GAME 1 -->
  <div class="game-card">
    <div class="game-title">
      <span>üîó Juftini top</span>
      <span class="status-badge" id="g1Status">‚ùì</span>
    </div>
    <div class="matching-box">
      <div class="col" id="dragNums"></div>
      <div class="col" id="dropWords"></div>
    </div>
    <button class="gameActionBtn primary" onclick="initMatchingGame()">Yangilash üîÑ</button>
  </div>

  <!-- GAME 3 -->
  <div class="game-card">
    <div class="game-title">
      <span>üçé Sanab ko‚Äòr (Count)</span>
      <span class="status-badge" id="g3Status">‚ùì</span>
    </div>
    <p style="text-align:center; color:var(--muted); font-weight:900;">Nechta olma bor?</p>
    <div id="emojiArea"></div>
    <div class="choiceRow" id="countChoices"></div>
    <button class="gameActionBtn gold" onclick="startCountingGame()">O'yinni boshlash ‚ñ∂</button>
  </div>

  <!-- GAME 4 -->
  <div class="game-card">
    <div class="game-title">
      <span>üß© Tartib (1-10)</span>
      <span class="status-badge" id="g4Status">‚ùì</span>
    </div>
    <p id="orderTask" style="text-align:center; font-weight:1000; color:var(--accent-dark)">Tartib bilan bosing</p>
    <div class="choiceRow" id="orderGrid"></div>
    <button class="gameActionBtn" style="background:#fff; border:2px solid #E5E7EB;" onclick="startOrderGame()">Boshlash ‚ñ∂</button>
  </div>
</div>

<script>
  const LESSON_ID = "lesson_2_final";
  const items = [
    {k: "1",  n: 1,  uz: "bir",     en: "one"},
    {k: "2",  n: 2,  uz: "ikki",    en: "two"},
    {k: "3",  n: 3,  uz: "uch",     en: "three"},
    {k: "4",  n: 4,  uz: "to'rt",   en: "four"},
    {k: "5",  n: 5,  uz: "besh",    en: "five"},
    {k: "6",  n: 6,  uz: "olti",    en: "six"},
    {k: "7",  n: 7,  uz: "yetti",   en: "seven"},
    {k: "8",  n: 8,  uz: "sakkiz",  en: "eight"},
    {k: "9",  n: 9,  uz: "to'qqiz", en: "nine"},
    {k: "10", n: 10, uz: "o'n",     en: "ten"}
  ];

  let state = {
    lang: 'uz',
    stars: {},           // key -> stars count (0..3)
    learned: {},         // key -> true if listened
    games: { g1: false, g3: false, g4: false }
  };

  /* ====== SOUND FEEDBACK ====== */
  let audioCtx = null;

  function beepSuccess(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      o.type = "triangle";
      o.frequency.setValueAtTime(520, t);
      o.frequency.exponentialRampToValueAtTime(880, t+0.12);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.25, t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, t+0.16);
      o.start(t); o.stop(t+0.18);
    }catch(e){}
  }

  function beepFail(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      o.type = "sawtooth";
      o.frequency.setValueAtTime(220, t);
      o.frequency.exponentialRampToValueAtTime(140, t+0.14);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.22, t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, t+0.16);
      o.start(t); o.stop(t+0.18);
    }catch(e){}
  }

  function init() {
    const saved = localStorage.getItem(LESSON_ID);
    if(saved){
      try{
        const s = JSON.parse(saved);
        // normalize
        state.lang = s.lang || 'uz';
        state.stars = s.stars || {};
        state.learned = s.learned || {};
        state.games = s.games || { g1:false, g3:false, g4:false };
      }catch{}
    }
    renderAll();
    // start a default game view
    initMatchingGame();
    startCountingGame();
    startOrderGame();
  }

  function save() { localStorage.setItem(LESSON_ID, JSON.stringify(state)); }

  function setLang(l) {
    state.lang = l;
    document.getElementById('btn-uz').classList.toggle('active', l === 'uz');
    document.getElementById('btn-en').classList.toggle('active', l === 'en');
    save();
    renderAll();
    // refresh matching words language
    initMatchingGame();
  }

  function renderAll() {
    renderVocab();
    updateProgress();
    updateGameStatus();
  }

  function renderVocab() {
    const g = document.getElementById('vocabGrid');
    g.innerHTML = items.map(it => `
      <div class="card">
        <div class="num-circle">${it.n}</div>
        <div class="word">${state.lang === 'uz' ? it.uz : it.en}</div>
        <button class="btn-play" onclick="speak('${it.uz}', '${it.k}')">üîä</button>
        <div class="starsLine">${"‚òÖ".repeat(Math.min(3, state.stars[it.k] || 0))}${"‚òÜ".repeat(3 - Math.min(3, state.stars[it.k] || 0))}</div>
      </div>
    `).join('');
  }

  function speak(uzText, key) {
    const it = items.find(x=>x.k===key);
    const text = (state.lang === 'uz') ? (it?.uz || uzText) : (it?.en || "");
    const msg = new SpeechSynthesisUtterance(text);

    // language
    msg.lang = (state.lang === 'uz') ? 'uz-UZ' : 'en-US';
    msg.rate = 0.95;
    msg.pitch = 1.05;

    try{
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(msg);
    }catch{}

    state.stars[key] = Math.min(3, (state.stars[key] || 0) + 1);
    state.learned[key] = true;

    beepSuccess();
    save();
    renderVocab();
    updateProgress();
  }

  function updateProgress() {
    const count = Object.values(state.learned).filter(Boolean).length;
    document.getElementById('progLabel').innerText = `${count} / 10 o'rganildi`;
    document.getElementById('progFill').style.width = (count * 10) + "%";
  }

  function updateGameStatus() {
    ['g1', 'g3', 'g4'].forEach(id => {
      const el = document.getElementById(id+'Status');
      const done = !!state.games[id];
      el.innerText = done ? "‚úÖ Bajarildi" : "‚ùì";
      el.classList.toggle("done", done);
    });
  }

  /* ===== GAME 1: MATCHING (improved) ===== */
  let matchesCorrect = 0;
  let matchesTotal = 0;

  function initMatchingGame() {
    const nCol = document.getElementById('dragNums');
    const wCol = document.getElementById('dropWords');

    const pool = [...items].sort(() => 0.5 - Math.random()).slice(0, 5);
    matchesCorrect = 0;
    matchesTotal = pool.length;

    nCol.innerHTML = '';
    wCol.innerHTML = '';

    pool.forEach(it => {
      const d = document.createElement('div');
      d.className='drag-item';
      d.draggable=true;
      d.innerText=it.n;
      d.dataset.k=it.k;

      d.ondragstart = e => e.dataTransfer.setData('text', it.k);
      nCol.appendChild(d);
    });

    [...pool].sort(() => 0.5 - Math.random()).forEach(it => {
      const dz = document.createElement('div');
      dz.className='drop-zone';
      dz.innerText = (state.lang==='uz'?it.uz:it.en);
      dz.dataset.k=it.k;

      dz.ondragover = e => { e.preventDefault(); dz.classList.add('over'); };

      dz.ondrop = e => {
        const k = e.dataTransfer.getData('text');

        if(k === dz.dataset.k){
          if(dz.classList.contains("matched")) return; // already solved
          dz.classList.add('matched');
          dz.innerText = "‚úÖ " + dz.innerText;
          matchesCorrect++;
          beepSuccess();

          if(matchesCorrect === matchesTotal){
            state.games.g1 = true;
            save();
            updateGameStatus();
          }
        } else {
          dz.classList.add('bad');
          beepFail();
          setTimeout(()=>dz.classList.remove('bad'),300);
        }

        dz.classList.remove('over');
      };

      wCol.appendChild(dz);
    });
  }

  /* ===== GAME 3: COUNTING (improved feedback) ===== */
  function startCountingGame() {
    const area = document.getElementById('emojiArea');
    const choices = document.getElementById('countChoices');
    const target = Math.floor(Math.random() * 10) + 1;

    area.innerText = "üçé".repeat(target);
    choices.innerHTML = "";

    const options = new Set([target]);
    while(options.size < 4) options.add(Math.floor(Math.random() * 10) + 1);

    [...options].sort(() => 0.5 - Math.random()).forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'btn-choice';
      btn.innerText = opt;

      btn.onclick = () => {
        if(opt === target) {
          btn.classList.add('good');
          beepSuccess();

          state.games.g3 = true;
          save();
          updateGameStatus();

          // next round
          setTimeout(startCountingGame, 800);
        } else {
          btn.classList.add('bad');
          beepFail();
          setTimeout(()=>btn.classList.remove('bad'), 300);
        }
      };

      choices.appendChild(btn);
    });
  }

  /* ===== GAME 4: ORDER (improved wrong feedback) ===== */
  let nextOrder = 1;

  function startOrderGame() {
    nextOrder = 1;
    const grid = document.getElementById('orderGrid');
    grid.innerHTML = "";
    document.getElementById('orderTask').innerText = "1 ni toping...";

    [...items].sort(() => 0.5 - Math.random()).forEach(it => {
      const btn = document.createElement('button');
      btn.className = 'btn-choice';
      btn.innerText = it.n;

      btn.onclick = () => {
        if(it.n === nextOrder) {
          btn.classList.add('good');
          btn.disabled = true;
          beepSuccess();

          if(nextOrder === 10) {
            state.games.g4 = true;
            save();
            updateGameStatus();
            document.getElementById('orderTask').innerText = "üéâ Barakalla!";
          } else {
            nextOrder++;
            document.getElementById('orderTask').innerText = nextOrder + " ni toping...";
          }
        } else {
          btn.classList.add('bad');
          beepFail();
          setTimeout(()=>btn.classList.remove('bad'), 250);
        }
      };

      grid.appendChild(btn);
    });
  }

  init();
</script>
</body>
</html>
