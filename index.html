<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Dono Bola!</title>

  <style>
    :root {
      /* Blasse Ikat-Farben */
      --ikat-red: rgba(225, 29, 72, 0.06);
      --ikat-blue: rgba(14, 165, 233, 0.06);
      --ikat-yellow: rgba(251, 191, 36, 0.06);
      --bg: #fdfdfd;
      --accent: #22c55e;
      --radius: 28px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; font-family: system-ui, sans-serif; background: var(--bg);
      color: #0f172a; padding: 15px; min-height: 100vh; overflow-x: hidden;
      user-select: none;
    }

    /* --- IKAT HINTERGRUND --- */
    .ikat-bg {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background: linear-gradient(90deg, transparent, var(--ikat-red) 15%, transparent 30%, var(--ikat-blue) 45%, transparent 60%, var(--ikat-yellow) 75%, transparent);
      background-size: 300px 100%; filter: blur(3px); opacity: 0.7;
    }

    .app { max-width: 500px; margin: 0 auto; position: relative; z-index: 1; }

    /* --- HEADER MIT PFLANZE --- */
    .header {
      background: rgba(255, 255, 255, 0.9); border-radius: var(--radius);
      padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06); backdrop-filter: blur(10px);
      margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.05);
    }

    .growth-stage { 
        font-size: 50px; 
        display: inline-block;
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    /* Tanz-Animation f√ºr die Blume */
    @keyframes plantDance {
      0%, 100% { transform: scale(1) rotate(0); }
      25% { transform: scale(1.2) rotate(-10deg); }
      75% { transform: scale(1.2) rotate(10deg); }
    }
    .dance { animation: plantDance 0.6s ease-out; }

    .name-display { font-size: 24px; font-weight: 900; color: #15803d; }

    /* --- PFAD --- */
    .path { 
        display: flex; gap: 12px; overflow-x: auto; padding: 10px 5px; 
        scrollbar-width: none; -webkit-overflow-scrolling: touch;
    }
    .path::-webkit-scrollbar { display: none; }
    
    .dot {
      min-width: 48px; height: 48px; border-radius: 16px; background: white;
      display: grid; place-items: center; font-weight: 900; 
      border-bottom: 5px solid #e2e8f0; transition: 0.2s;
    }
    .dot.done { background: var(--accent); border-color: #15803d; color: white; }
    .dot.active { background: #dcfce7; border-color: #86efac; color: #166534; }

    /* --- LESSON TILES --- */
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    
    .tile {
      background: white; border-radius: var(--radius); padding: 20px 10px;
      text-decoration: none; color: inherit; border-bottom: 7px solid #e2e8f0;
      transition: all 0.1s; display: flex; flex-direction: column; 
      align-items: center; position: relative;
    }
    .tile:active { transform: translateY(4px); border-bottom-width: 0; }
    
    .tile-icon { font-size: 60px; margin-bottom: 8px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
    .tile-label { font-size: 16px; font-weight: 800; text-align: center; color: #334155; }
    
    .locked { opacity: 0.6; filter: grayscale(1); }
    .lock-badge { position: absolute; top: 12px; right: 12px; font-size: 14px; }

    .star-count {
        font-size: 12px; font-weight: 900; color: #22c55e; 
        background: #f0fdf4; padding: 2px 8px; border-radius: 10px; margin-top: 8px;
    }

    /* --- BUTTONS --- */
    .btn {
      width: 100%; padding: 18px; border-radius: 22px; border: none;
      font-weight: 900; font-size: 18px; cursor: pointer; 
      border-bottom: 5px solid rgba(0,0,0,0.15); transition: 0.1s;
    }
    .btn:active { transform: translateY(3px); border-bottom-width: 0; }
    
    .primary { background: var(--accent); color: white; margin-top: 25px; }
    .ghost { background: transparent; border: 2px dashed #cbd5e1; color: #94a3b8; margin-top: 15px; border-bottom: none; font-size: 14px; }

    /* --- MODAL --- */
    .modal {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px);
      display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px;
    }
    .modal.show { display: flex; }
    .modal-card { background: white; padding: 35px; border-radius: 35px; width: 100%; max-width: 350px; text-align: center; }
    .input { width: 100%; padding: 18px; border-radius: 18px; border: 3px solid #f1f5f9; font-size: 22px; text-align: center; margin: 20px 0; outline: none; }
    .input:focus { border-color: var(--accent); }
  </style>
</head>

<body>
  <div class="ikat-bg"></div>

  <div class="app">
    <div class="header">
      <div style="display: flex; align-items: center; gap: 15px;">
        <div id="plant" class="growth-stage">üå±</div>
        <div class="name-display" id="displayName">Salom!</div>
      </div>
      <button onclick="showNameGate()" style="background:none; border:none; font-size: 24px; cursor:pointer;">‚úèÔ∏è</button>
    </div>

    <div class="path" id="pathNodes"></div>

    <div class="grid" id="grid"></div>

    <button class="btn primary" id="premBtn">üîì OK</button>
    <button class="btn ghost" onclick="resetAll()">‚ôªÔ∏è Qayta boshlash</button>
  </div>

  <div class="modal" id="gate">
    <div class="modal-card">
      <div style="font-size: 70px">ü¶Å</div>
      <h2 style="margin: 15px 0; font-weight: 900;">Isming?</h2>
      <input type="text" id="nameInp" class="input" placeholder="..." maxlength="10">
      <button class="btn primary" onclick="saveName()">OK! üöÄ</button>
    </div>
  </div>

  <script>
    const LESSONS = [
      { id:1, icon:"üëã", title:"Salom", count:5, free:true },
      { id:2, icon:"üî¢", title:"Sonlar", count:10 },
      { id:3, icon:"üêæ", title:"Hayvon", count:8 },
      { id:4, icon:"üé®", title:"Rang", count:10 },
      { id:5, icon:"üçé", title:"Meva", count:10 },
      { id:6, icon:"üè†", title:"Uy", count:10 }
    ];

    const STAGES = ["üå±", "üåø", "ü™¥", "üåª", "üå≥", "üèÜ"];

    function updateUI() {
      const name = localStorage.getItem("childName");
      if(!name) document.getElementById("gate").classList.add("show");
      document.getElementById("displayName").innerText = name || "Salom!";

      const learned = new Set(JSON.parse(localStorage.getItem("learned") || "[]"));
      const totalWords = LESSONS.reduce((s,l)=>s+l.count,0);
      const progress = totalWords > 0 ? learned.size / totalWords : 0;

      // Pflanze wachsen lassen
      const plantEl = document.getElementById("plant");
      const stageIdx = Math.min(Math.floor(progress * STAGES.length), STAGES.length - 1);
      
      // Wenn Fortschritt gemacht wurde, tanzen lassen
      const currentEmoji = plantEl.innerText;
      if(currentEmoji !== STAGES[stageIdx] || localStorage.getItem("justLearned") === "true") {
          plantEl.innerText = STAGES[stageIdx];
          plantEl.classList.add("dance");
          setTimeout(() => plantEl.classList.remove("dance"), 600);
          localStorage.removeItem("justLearned");
      }

      renderGrid(learned);
      renderPath(learned);
    }

    function renderGrid(learned) {
      const container = document.getElementById("grid");
      container.innerHTML = "";
      const isP = localStorage.getItem("premium") === "true";

      LESSONS.forEach(l => {
        const c = Array.from(learned).filter(k => k.startsWith("L"+l.id+"_")).length;
        const unlocked = l.free || isP;
        
        const tile = document.createElement("div");
        tile.className = `tile ${unlocked ? '' : 'locked'}`;
        tile.innerHTML = `
          ${unlocked ? '' : '<span class="lock-badge">üîí</span>'}
          <div class="tile-icon">${l.icon}</div>
          <div class="tile-label">${l.title}</div>
          <div class="star-count">${c}/${l.count} ‚≠ê</div>
        `;
        tile.onclick = () => { 
            if(unlocked) {
                // Simuliere Erfolg beim Klick f√ºr Demo-Zwecke (eigentlich in lesson.html)
                location.href = `lesson${l.id}.html`; 
            } else {
                alert("Ochish uchun bosing! üîì");
            }
        };
        container.appendChild(tile);
      });
    }

    function renderPath(learned) {
      const path = document.getElementById("pathNodes");
      path.innerHTML = "";
      const isP = localStorage.getItem("premium") === "true";

      LESSONS.forEach(l => {
        const c = Array.from(learned).filter(k => k.startsWith("L"+l.id+"_")).length;
        const dot = document.createElement("div");
        const isDone = c >= l.count;
        const isUnlocked = l.free || isP;
        
        dot.className = `dot ${isDone ? 'done' : (isUnlocked ? 'active' : '')}`;
        dot.innerText = isDone ? '‚úÖ' : l.id;
        path.appendChild(dot);
      });
    }

    function saveName() {
      const n = document.getElementById("nameInp").value.trim();
      if(n.length >= 2) { 
        localStorage.setItem("childName", n); 
        document.getElementById("gate").classList.remove("show"); 
        updateUI(); 
      }
    }

    function showNameGate() { document.getElementById("gate").classList.add("show"); }
    
    function resetAll() { 
        if(confirm("Hamma natijalarni o'chirib tashlaymizmi?")) { 
            localStorage.clear(); 
            location.reload(); 
        } 
    }

    document.getElementById("premBtn").onclick = () => { 
        localStorage.setItem("premium", "true"); 
        localStorage.setItem("justLearned", "true"); // Effekt ausl√∂sen
        updateUI(); 
    };

    // Initialer Start
    updateUI();
  </script>
</body>
</html>
