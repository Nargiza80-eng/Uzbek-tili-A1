<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dono Bola! (4‚Äì6)</title>

  <style>
    :root{
      --bg1:#dff7f0;
      --bg2:#eaf6ff;

      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:rgba(15,23,42,.12);

      --accent:#22c55e;
      --shadow:0 14px 30px rgba(2,6,23,.12);
      --radius:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      padding:16px;
      min-height:100vh;
      overflow-x:hidden;

      background:
        linear-gradient(180deg, rgba(223,247,240,.92), rgba(234,246,255,.92)),
        url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27720%27%20height%3D%27720%27%20viewBox%3D%270%200%20720%20720%27%3E%3Crect%20width%3D%27720%27%20height%3D%27720%27%20fill%3D%27%23f7fbff%27/%3E%3Cg%20opacity%3D%270.22%27%3E%3Cg%20transform%3D%27translate(40%2C40)%27%3E%3Cpath%20d%3D%27M120%200%20L160%2040%20L120%2080%20L80%2040%20Z%27%20fill%3D%27%230ea5a4%27/%3E%3Cpath%20d%3D%27M120%20110%20L170%20160%20L120%20210%20L70%20160%20Z%27%20fill%3D%27%2322c55e%27/%3E%3Cpath%20d%3D%27M120%20240%20L160%20280%20L120%20320%20L80%20280%20Z%27%20fill%3D%27%23f59e0b%27/%3E%3Cpath%20d%3D%27M0%20120%20L40%20160%20L0%20200%20L-40%20160%20Z%27%20fill%3D%27%2314b8a6%27/%3E%3Cpath%20d%3D%27M240%20120%20L280%20160%20L240%20200%20L200%20160%20Z%27%20fill%3D%27%2310b981%27/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      background-size: cover, 720px 720px;
      background-attachment: fixed, fixed;
    }

    .app{max-width:860px;margin:0 auto}

    .top{
      background:rgba(255,255,255,.92);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      backdrop-filter: blur(6px);
      position:relative;
      overflow:hidden;
    }

    /* Hero */
    .hero{display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;justify-content:space-between}
    .heroLeft{display:flex;gap:14px;align-items:center;flex-wrap:wrap}

    .sunWrap{position:relative; width:100px; height:100px; flex:0 0 auto;}
    .sun{
      width:100px;height:100px;border-radius:999px;
      display:grid;place-items:center;
      background: radial-gradient(circle at 30% 30%, #fff6cc, #fbbf24 55%, #f59e0b 100%);
      box-shadow: 0 12px 28px rgba(245,158,11,.34);
      border: 5px solid rgba(255,255,255,.72);
    }
    .sunPct{font-weight:1000;font-size:22px;color:#7c2d12;text-shadow: 0 2px 0 rgba(255,255,255,.35)}

    h1{margin:0;font-size:24px;font-weight:1000;letter-spacing:.2px}

    .helloBig{
      margin-top:6px;
      font-weight:1000;
      font-size:38px;
      line-height:1.05;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .helloBig .name{
      color:#065f46;
      text-shadow: 0 2px 0 rgba(255,255,255,.45);
    }

    /* Header right */
    .topActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      position:relative;
    }
    .profileBtn{
      border-radius:18px;
      font-weight:1000;
      border:1px solid rgba(15,23,42,.14);
      cursor:pointer;
      user-select:none;
      padding:12px 14px;
      background: rgba(255,255,255,.94);
      display:flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
      font-size:16px;
    }
    .profileMenu{
      position:absolute;
      right:0;
      top:52px;
      width:220px;
      background: rgba(255,255,255,.97);
      border:1px solid rgba(15,23,42,.12);
      border-radius:18px;
      box-shadow: 0 18px 36px rgba(2,6,23,.16);
      padding:8px;
      display:none;
      z-index:50;
    }
    .profileMenu.show{display:block}
    .menuItem{
      width:100%;
      text-align:left;
      border-radius:14px;
      padding:12px 12px;
      border:1px solid transparent;
      background:transparent;
      font-weight:900;
      cursor:pointer;
      font-size:16px;
    }
    .menuItem:hover{background: rgba(15,23,42,.06)}
    .menuItem:active{transform: translateY(1px)}

    .pill{
      background: rgba(34,197,94,.14);
      border:1px solid rgba(34,197,94,.24);
      color:#065f46;
      padding:8px 12px;
      border-radius:999px;
      font-weight:1000;
      font-size:13px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .pill.free{
      background: rgba(245,158,11,.14);
      border-color: rgba(245,158,11,.24);
      color:#7c2d12;
    }

    /* Yutuq */
    .barWrap{
      margin-top:12px;
      background:rgba(255,255,255,.96);
      border:1px solid var(--line);
      border-radius:20px;
      padding:14px;
      box-shadow: 0 12px 28px rgba(2,6,23,.07);
    }
    .barRow{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      flex-wrap:wrap
    }
    .barLabel{font-weight:1000;font-size:18px}
    .barText{color:var(--muted);font-weight:1000;font-size:16px}
    .bar{
      margin-top:12px;
      height:18px;
      background: rgba(15,23,42,.10);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.10);
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      border-radius:999px;
      transition: width .45s ease;
    }

    /* Yutuq icons (nur wenn fertig) */
    .achRow{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .achIcon{
      width:44px;height:44px;
      border-radius:999px;
      display:grid;
      place-items:center;
      font-size:22px;
      background: rgba(34,197,94,.18);
      border:2px solid rgba(34,197,94,.35);
      box-shadow: 0 14px 28px rgba(2,6,23,.10);
    }

    /* Lesson grid -> deutlich sichtbarer Pfad */
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
      position:relative;
      padding-left:26px; /* Platz f√ºr dicken Pfad */
    }
    .grid::before{
      content:"";
      position:absolute;
      left:10px;
      top:10px;
      bottom:10px;
      width:10px;
      border-radius:999px;
      background: linear-gradient(180deg, rgba(34,197,94,.40), rgba(59,130,246,.35), rgba(245,158,11,.35));
      border:2px solid rgba(15,23,42,.10);
      box-shadow: 0 16px 34px rgba(2,6,23,.10);
    }

    .tile{
      background:rgba(255,255,255,.97);
      border:2px solid rgba(15,23,42,.10);
      border-radius:26px;
      box-shadow: 0 18px 38px rgba(2,6,23,.14);
      padding:18px 18px 18px 18px;
      text-decoration:none;
      color:inherit;
      display:flex;
      gap:16px;
      align-items:center;
      position:relative;
      overflow:hidden;
      min-height:140px;
      touch-action: manipulation;
      cursor:pointer;
    }
    .tile:active{transform: translateY(1px)}

    /* gro√üer Pfad-Punkt */
    .stepDot{
      position:absolute;
      left:-26px;
      top:50%;
      transform: translateY(-50%);
      width:34px;height:34px;
      border-radius:999px;
      background: rgba(255,255,255,.98);
      border:3px solid rgba(15,23,42,.20);
      box-shadow: 0 16px 34px rgba(2,6,23,.12);
    }
    .tile.done .stepDot{
      border-color: rgba(34,197,94,.65);
      background: rgba(34,197,94,.22);
    }
    .tile.current .stepDot{
      border-color: rgba(245,158,11,.75);
      background: rgba(245,158,11,.22);
    }

    /* gro√üe, farbintensive Icons */
    .icon{
      width:120px;height:120px;border-radius:28px;
      display:grid;place-items:center;
      font-size:64px;
      flex:0 0 auto;
      border:2px solid rgba(15,23,42,.10);
      box-shadow: 0 18px 40px rgba(2,6,23,.14);
    }

    /* NUR Lektionsname (keine anderen W√∂rter) */
    .title{
      font-size:28px;
      font-weight:1000;
      line-height:1.1;
      letter-spacing:.2px;
    }

    /* OCHMOQ sehr gro√ü */
    .tagRight{
      position:absolute;
      top:14px; right:14px;
      font-size:18px;
      font-weight:1100;
      padding:10px 14px;
      border-radius:999px;
      border:2px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.92);
      color: rgba(15,23,42,.90);
      letter-spacing:.8px;
      text-transform: uppercase;
    }
    .tagRight.open{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.16);
      color:#065f46;
    }
    .tagRight.lock{
      border-color: rgba(15,23,42,.14);
      background: rgba(15,23,42,.06);
      color: rgba(15,23,42,.70);
    }

    .tile.locked{opacity:.72; filter: grayscale(.18);}
    .tile.locked .icon{filter: grayscale(.1); opacity:.9;}

    /* Bottom buttons */
    .btnRow{margin-top:16px;display:flex;gap:12px;flex-wrap:wrap}
    .btnWide{
      flex:1;min-width:240px;
      text-align:center;
      padding:16px;
      border-radius:20px;
      font-weight:1000;
      border:1px solid transparent;
      cursor:pointer;
      user-select:none;
      font-size:18px;
    }
    .btnWide.primary{
      background: linear-gradient(180deg, #34d399, #22c55e);
      color:#052e1b;
      border-color: rgba(5,46,27,.10);
      box-shadow: 0 18px 40px rgba(34,197,94,.22);
    }
    .btnWide.secondary{
      background: rgba(255,255,255,.96);
      color: var(--ink);
      border-color: var(--line);
    }

    /* Name Gate */
    .gate{
      position:fixed;
      inset:0;
      z-index:10000;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      background:
        radial-gradient(circle at 25% 15%, rgba(255,255,255,.18), transparent 35%),
        radial-gradient(circle at 80% 25%, rgba(255,255,255,.14), transparent 40%),
        rgba(2,6,23,.55);
      backdrop-filter: blur(10px) saturate(1.1);
    }
    .gate.show{display:flex}
    .gateCard{
      width:min(520px, 92vw);
      background: rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.35);
      border-radius:26px;
      box-shadow: 0 22px 70px rgba(2,6,23,.35);
      padding:16px;
      text-align:center;
    }
    .gateTitle{font-size:24px;font-weight:1000;margin:6px 0 6px}
    .gateText{margin:0 0 12px;color: rgba(15,23,42,.78);font-weight:900;}
    .nameInput{
      width:min(360px, 86vw);
      padding:14px 14px;
      border-radius:18px;
      border:1px solid rgba(15,23,42,.18);
      font-weight:1000;
      font-size:18px;
      outline:none;
      background: rgba(255,255,255,.95);
    }
    .nameInput:focus{border-color: rgba(59,130,246,.55);box-shadow: 0 0 0 6px rgba(59,130,246,.18);}
    .gateBtn{
      width:min(360px, 86vw);
      margin-top:10px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(5,46,27,.10);
      background: linear-gradient(180deg, #34d399, #22c55e);
      color:#052e1b;
      font-weight:1000;
      cursor:pointer;
      opacity:.55;
      font-size:18px;
    }
    .gateBtn.enabled{opacity:1}
    .gateHint{margin-top:10px;font-size:12.5px;font-weight:900;color: rgba(15,23,42,.62);}

    @media (min-width: 768px){
      .app{max-width:760px;}
      .helloBig{font-size:44px;}
      .title{font-size:32px;}
      .icon{width:132px;height:132px;font-size:72px;}
      .tile{min-height:150px;}
      .tagRight{font-size:20px;padding:12px 16px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="top">

      <div class="hero">
        <div class="heroLeft">
          <div class="sunWrap" aria-hidden="true">
            <div class="sun"><div class="sunPct" id="mainPct">0%</div></div>
          </div>

          <div>
            <h1>üåø Dono Bola!</h1>

            <div class="helloBig" id="helloBig">
              <span>ü¶Å</span>
              <span id="helloWord">Salom,</span>
              <span class="name" id="childNameBig">Do‚Äòst!</span>
              <span>‚ú®</span>
            </div>
          </div>
        </div>

        <div class="topActions">
          <button class="profileBtn" id="profileBtn" type="button" aria-haspopup="menu" aria-expanded="false">
            üßí <span id="profileName">Do‚Äòst</span> ‚ñæ
          </button>

          <div class="profileMenu" id="profileMenu" role="menu">
            <button class="menuItem" id="changeNameBtn" type="button">‚úèÔ∏è Ismni o‚Äòzgartirish</button>
          </div>

          <div class="pill free" id="premiumBadge">FREE</div>
        </div>
      </div>

      <!-- Yutuq bleibt -->
      <div class="barWrap">
        <div class="barRow">
          <div class="barLabel">‚≠ê Yutuq</div>
          <div class="barText" id="progressText">0 / 93</div>
          <div class="achRow" id="achRow"></div>
        </div>

        <div class="bar">
          <div class="fill" id="progressFill"></div>
        </div>
      </div>

      <!-- NUR K√§stchen (mit deutlichem Pfad) -->
      <div class="grid" id="lessonGrid"></div>

      <div class="btnRow">
        <button class="btnWide primary" id="premiumBtn" type="button">üîì Premium</button>
        <button class="btnWide secondary" id="resetBtn" type="button">‚ôªÔ∏è Reset</button>
      </div>

    </div>
  </div>

  <!-- Name Gate -->
  <div class="gate" id="nameGate">
    <div class="gateCard" role="dialog" aria-modal="true">
      <div style="font-size:44px; line-height:1;">üßí‚ú®</div>
      <div class="gateTitle">Isming nima?</div>
      <p class="gateText">Avval ismingni yoz ‚úçÔ∏è</p>
      <input class="nameInput" id="nameInput" type="text" autocomplete="name"
             placeholder="Masalan: Ali" maxlength="18" />
      <button class="gateBtn" id="startBtn" type="button">Boshlaymiz! üöÄ</button>
      <div class="gateHint">Maslahat: 2 ta harf yetadi üôÇ</div>
    </div>
  </div>

  <!-- Paywall Gate (Demo) -->
  <div class="gate" id="paywallGate">
    <div class="gateCard" role="dialog" aria-modal="true">
      <div style="font-size:44px; line-height:1;">üîì‚ú®</div>
      <div class="gateTitle">Vollversion</div>
      <p class="gateText">Bir marta to‚Äòlov ‚úÖ</p>

      <button class="gateBtn enabled" id="buyBtn" type="button">üîì Ochish (Demo)</button>
      <button class="btnWide secondary" id="restoreBtn" type="button" style="margin-top:10px;">‚ôªÔ∏è Restore (Demo)</button>
      <button class="btnWide secondary" id="closePaywallBtn" type="button" style="margin-top:10px;">Yopish</button>
    </div>
  </div>

<script>
  /***************
   * CONFIG
   ***************/
  const PREMIUM_KEY = "premium_unlocked";
  const CHILD_KEY   = "childName";

  // Du wolltest "ochmoq" gro√ü und deutlich:
  const OPEN_LABEL = "OCHMOQ";

  // "Fertig"-Regel (pro Lektion)
  const MIN_WORDS_PER_LESSON = {
    1: 5, 2: 5, 3: 5, 4: 5, 5: 5,
    6: 5, 7: 5, 8: 5, 9: 5, 10: 5
  };

  function getLearnedSet(){
    try { return new Set(JSON.parse(localStorage.getItem("learned") || "[]")); }
    catch { return new Set(); }
  }

  const LESSONS = [
    { id: 1, file:"lesson1.html", icon:"üëã", title:"1-dars: Salomlashuv", free:true  },
    { id: 2, file:"lesson2.html", icon:"üî¢", title:"2-dars: Sonlar",      free:false },
    { id: 3, file:"lesson3.html", icon:"üêæ", title:"3-dars: Hayvonlar",   free:false },
    { id: 4, file:"lesson4.html", icon:"üé®", title:"4-dars: Ranglar",     free:false },
    { id: 5, file:"lesson5.html", icon:"üçé", title:"5-dars: Mevalar",     free:false },
    { id: 6, file:"lesson6.html", icon:"ü•ï", title:"6-dars: Sabzavot",    free:false },
    { id: 7, file:"lesson7.html", icon:"üè†", title:"7-dars: Uy",          free:false },
    { id: 8, file:"lesson8.html", icon:"üëï", title:"8-dars: Kiyim",       free:false },
    { id: 9, file:"lesson9.html", icon:"üöó", title:"9-dars: Transport",   free:false },
    { id:10, file:"lesson10.html",icon:"üåô", title:"10-dars: Kun tartibi",free:false }
  ];

  // Pastell-Farben pro Lektion (intensiv, aber pastell)
  const PASTELS = [
    ["rgba(254, 202, 202, .75)", "rgba(248, 113, 113, .25)"], // rot
    ["rgba(254, 215, 170, .80)", "rgba(251, 146, 60, .25)"],  // orange
    ["rgba(253, 230, 138, .85)", "rgba(250, 204, 21, .25)"],  // gelb
    ["rgba(187, 247, 208, .80)", "rgba(34, 197, 94, .22)"],   // gr√ºn
    ["rgba(167, 243, 208, .80)", "rgba(20, 184, 166, .22)"],  // teal
    ["rgba(191, 219, 254, .85)", "rgba(59, 130, 246, .22)"],  // blau
    ["rgba(199, 210, 254, .85)", "rgba(99, 102, 241, .22)"],  // indigo
    ["rgba(221, 214, 254, .85)", "rgba(168, 85, 247, .22)"],  // lila
    ["rgba(251, 207, 232, .85)", "rgba(236, 72, 153, .22)"],  // pink
    ["rgba(226, 232, 240, .90)", "rgba(100, 116, 139, .22)"]  // grau
  ];

  const TOTAL_WORDS = 93;

  function isPremium(){ return localStorage.getItem(PREMIUM_KEY) === "true"; }
  function setPremium(v){ localStorage.setItem(PREMIUM_KEY, v ? "true" : "false"); }

  function normalizeName(s){ return (s || "").trim().replace(/\s+/g, " ").slice(0, 18); }

  function lessonLearnedCount(learnedSet, lessonId){
    let c = 0;
    const prefix = "L" + lessonId + "_";
    for (const key of learnedSet){
      if (key.startsWith(prefix)) c++;
    }
    return c;
  }

  function isLessonCompleted(learnedSet, lessonId){
    const need = MIN_WORDS_PER_LESSON[lessonId] ?? 1;
    return lessonLearnedCount(learnedSet, lessonId) >= need;
  }

  function canOpenLesson(learnedSet, lessonId){
    if(lessonId === 1) return true;
    if(isPremium()) return true;
    return isLessonCompleted(learnedSet, lessonId-1);
  }

  function lockReason(lessonId){
    if(isPremium()) return null;
    if(lessonId === 1) return null;
    return `üîí ${lessonId-1}-dars`;
  }

  function openPaywall(){ document.getElementById("paywallGate").classList.add("show"); }
  function closePaywall(){ document.getElementById("paywallGate").classList.remove("show"); }

  /***************
   * UI
   ***************/
  function updatePremiumBadge(){
    const b = document.getElementById("premiumBadge");
    if(!b) return;
    if(isPremium()){
      b.classList.remove("free");
      b.innerText = "PREMIUM ‚úÖ";
    } else {
      b.classList.add("free");
      b.innerText = "FREE";
    }
  }

  function applyGreeting(){
    const name = localStorage.getItem(CHILD_KEY) || "";
    const child = name ? name : "Do‚Äòst!";
    document.getElementById("childNameBig").innerText = child;
    const pn = document.getElementById("profileName");
    if(pn) pn.innerText = child.replace("!", "");
  }

  function showNameGate(){
    const gate = document.getElementById("nameGate");
    gate.classList.add("show");
    const input = document.getElementById("nameInput");
    const btn = document.getElementById("startBtn");

    btn.classList.remove("enabled");
    btn.disabled = true;
    input.value = "";

    setTimeout(() => input.focus(), 50);

    const validate = () => {
      const nm = normalizeName(input.value);
      const ok = nm.length >= 2;
      btn.disabled = !ok;
      btn.classList.toggle("enabled", ok);
    };

    input.oninput = validate;
    input.onkeydown = (e)=>{ if(e.key==="Enter" && !btn.disabled) btn.click(); };

    btn.onclick = () => {
      const nm = normalizeName(input.value);
      if(nm.length < 2) return;
      localStorage.setItem(CHILD_KEY, nm);
      gate.classList.remove("show");
      applyGreeting();
    };
  }

  // Yutuq: Symbole nur wenn fertig
  function renderYutuqIcons(){
    const learned = getLearnedSet();
    const row = document.getElementById("achRow");
    if(!row) return;
    row.innerHTML = "";

    LESSONS.forEach((L)=>{
      if(isLessonCompleted(learned, L.id)){
        const d = document.createElement("div");
        d.className = "achIcon";
        d.title = `${L.id}-dars ‚úÖ`;
        d.textContent = L.icon;
        row.appendChild(d);
      }
    });
  }

  function renderLessons(){
    const learned = getLearnedSet();

    const learnedCount = learned.size;
    const pct = Math.max(0, Math.min(100, Math.round((learnedCount / TOTAL_WORDS) * 100)));
    document.getElementById("mainPct").innerText = pct + "%";
    document.getElementById("progressText").innerText = `${learnedCount} / ${TOTAL_WORDS}`;
    document.getElementById("progressFill").style.width = pct + "%";

    const grid = document.getElementById("lessonGrid");
    grid.innerHTML = "";

    // current: erste offene Lektion, die noch nicht fertig ist
    let current = 1;
    for(let i=1;i<=LESSONS.length;i++){
      if(canOpenLesson(learned, i) && !isLessonCompleted(learned, i)){
        current = i; break;
      }
      if(isLessonCompleted(learned, i)) current = Math.min(LESSONS.length, i+1);
    }

    LESSONS.forEach((L, idx) => {
      const open = canOpenLesson(learned, L.id);
      const done = isLessonCompleted(learned, L.id);
      const isCurrent = (L.id === current);

      const a = document.createElement("a");
      a.className = "tile" + (open ? "" : " locked") + (done ? " done" : "") + (isCurrent ? " current" : "");
      a.href = open ? L.file : "#";

      const step = document.createElement("div");
      step.className = "stepDot";
      a.appendChild(step);

      const [bg, glow] = PASTELS[idx % PASTELS.length];

      const icon = document.createElement("div");
      icon.className = "icon";
      icon.textContent = L.icon;
      icon.style.background = `linear-gradient(180deg, ${bg}, rgba(255,255,255,.85))`;
      icon.style.boxShadow = `0 22px 50px ${glow}`;
      a.appendChild(icon);

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = L.title;
      a.appendChild(title);

      const tag = document.createElement("div");
      tag.className = "tagRight " + (open ? "open" : "lock");

      if(L.id === 1 && !isPremium()){
        tag.textContent = "FREE";
      } else if(isPremium()){
        tag.textContent = done ? `${OPEN_LABEL} ‚úÖ` : OPEN_LABEL;
      } else {
        tag.textContent = open ? (done ? `${OPEN_LABEL} ‚úÖ` : OPEN_LABEL) : lockReason(L.id);
      }
      a.appendChild(tag);

      a.addEventListener("click", (e)=>{
        if(!open){
          e.preventDefault();
          openPaywall();
        }
      });

      grid.appendChild(a);
    });
  }

  function updateAll(){
    updatePremiumBadge();
    applyGreeting();
    renderYutuqIcons();
    renderLessons();
  }

  /***************
   * Events
   ***************/
  function wireUI(){
    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");

    profileBtn?.addEventListener("click", ()=>{
      const isOpen = profileMenu.classList.toggle("show");
      profileBtn.setAttribute("aria-expanded", String(isOpen));
    });

    document.addEventListener("click", (e)=>{
      if(!profileMenu || !profileBtn) return;
      const inside = profileMenu.contains(e.target) || profileBtn.contains(e.target);
      if(!inside){
        profileMenu.classList.remove("show");
        profileBtn.setAttribute("aria-expanded","false");
      }
    });

    document.getElementById("changeNameBtn").addEventListener("click", ()=>{
      profileMenu?.classList.remove("show");
      localStorage.removeItem(CHILD_KEY);
      showNameGate();
    });

    document.getElementById("premiumBtn").addEventListener("click", ()=> openPaywall());

    document.getElementById("buyBtn").addEventListener("click", ()=>{
      setPremium(true);
      closePaywall();
      updateAll();
      alert("‚úÖ Premium (demo) aktiv!");
    });

    document.getElementById("restoreBtn").addEventListener("click", ()=>{
      updateAll();
      alert(isPremium() ? "‚úÖ Premium topildi!" : "‚ùå Premium yo‚Äòq (demo).");
    });

    document.getElementById("closePaywallBtn").addEventListener("click", ()=> closePaywall());
    document.getElementById("paywallGate").addEventListener("click", (e)=>{
      if(e.target.id === "paywallGate") closePaywall();
    });

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      const ok = confirm("Hammasini qaytadan boshlaymizmi? (Natija o‚Äòchadi)");
      if(!ok) return;
      localStorage.removeItem("learned");
      localStorage.removeItem(PREMIUM_KEY);
      updateAll();
    });

    window.addEventListener("focus", updateAll);
    document.addEventListener("visibilitychange", ()=>{ if(!document.hidden) updateAll(); });
    window.addEventListener("pageshow", updateAll);

    // Dev: Shift+P clears premium
    document.addEventListener("keydown", (e)=>{
      if(e.shiftKey && (e.key==="P" || e.key==="p")){
        localStorage.removeItem(PREMIUM_KEY);
        alert("üß™ Test: Premium gel√∂scht");
        updateAll();
      }
    });
  }

  window.addEventListener("load", ()=>{
    wireUI();
    const nm = localStorage.getItem(CHILD_KEY);
    if(!nm) showNameGate();
    updateAll();
  });
</script>
</body>
</html>
